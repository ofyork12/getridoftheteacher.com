<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Language Learning - French Vocabulary</title>
  <style>
    :root {
      --primary-color: #fff;
      --bg-color: #000;
      --card-bg: #111;
      --accent-color: #4a9eff;
      --hover-color: #333;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg-color);
      color: var(--primary-color);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      padding: 20px 12px 40px;
      overflow-y: auto;
      -webkit-tap-highlight-color: transparent;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .navigation {
      display: flex;
      gap: 20px;
      margin: 20px 0 30px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .nav-button {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      background: transparent;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }
    .nav-button:hover {
      background: var(--primary-color);
      color: var(--bg-color);
    }
    .game-button {
      display: block;
      margin: 20px auto 30px;
      padding: 18px 40px;
      font-size: 20px;
      font-weight: bold;
      background: var(--accent-color);
      color: var(--bg-color);
      border: 3px solid var(--accent-color);
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 4px 12px rgba(74, 158, 255, 0.4);
    }
    .game-button:hover {
      background: #6bb0ff;
      border-color: #6bb0ff;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(74, 158, 255, 0.5);
    }
    .game-button:active {
      transform: translateY(0);
    }
    h1 {
      text-align: center;
      font-size: clamp(28px, 5vw, 42px);
      margin: 0 0 30px;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 30px;
      justify-content: center;
      align-items: center;
    }
    .lang-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .game-nav-button {
      padding: 10px 20px;
      border: 2px solid var(--primary-color);
      border-radius: 999px;
      background: transparent;
      color: var(--primary-color);
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 140px;
      text-align: center;
      text-decoration: none;
      display: block;
    }
    .game-nav-button:hover {
      background: var(--hover-color);
    }
    .controls button {
      padding: 10px 20px;
      border: 2px solid var(--primary-color);
      border-radius: 999px;
      background: transparent;
      color: var(--primary-color);
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 120px;
    }
    .controls button:hover {
      background: var(--hover-color);
    }
    .controls button.active {
      background: var(--primary-color);
      color: var(--bg-color);
    }
    .search-box {
      width: 100%;
      max-width: 400px;
      padding: 12px 20px;
      border: 2px solid var(--primary-color);
      border-radius: 999px;
      background: var(--card-bg);
      color: var(--primary-color);
      font-size: 16px;
      margin: 0 auto 30px;
      display: block;
    }
    .search-box:focus {
      outline: none;
      border-color: var(--accent-color);
    }
    .vocab-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .vocab-card {
      background: var(--card-bg);
      border: 2px solid var(--primary-color);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .vocab-card:hover {
      border-color: var(--accent-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(74, 158, 255, 0.3);
    }
    .vocab-word {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 12px;
      color: var(--accent-color);
    }
    .vocab-translations {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .translation-row {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 8px 0;
      border-bottom: 1px solid #333;
    }
    .translation-row:last-child {
      border-bottom: none;
    }
    .lang-label {
      font-weight: bold;
      min-width: 80px;
      font-size: 14px;
      text-transform: uppercase;
      opacity: 0.8;
    }
    .lang-content {
      flex: 1;
      font-size: 16px;
    }
    .pinyin {
      font-size: 14px;
      opacity: 0.7;
      font-style: italic;
      margin-top: 4px;
    }
    .play-button {
      background: var(--accent-color);
      border: none;
      color: var(--bg-color);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      flex-shrink: 0;
    }
    .play-button:hover {
      background: #6bb0ff;
      transform: scale(1.1);
    }
    .play-button:active {
      transform: scale(0.95);
    }
    .no-results {
      text-align: center;
      padding: 40px;
      font-size: 18px;
      opacity: 0.6;
    }
    @media (max-width: 768px) {
      .vocab-grid {
        grid-template-columns: 1fr;
      }
      .controls button {
        min-width: 100px;
        font-size: 14px;
        padding: 8px 16px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="navigation">
      <a href="language-learning.html" class="nav-button">Language Home</a>
      <a href="index.html" class="nav-button">Math Home</a>
      <button onclick="downloadPDF()" class="nav-button">ðŸ“¥ Download PDF</button>
    </div>
    
    <h1>Language Learning - French Vocabulary</h1>
    
    <a href="language-learning-game-fr.html" class="game-button">ðŸŽ® Play French Game</a>
    
    <div class="controls" role="group" aria-label="Vocabulary navigation">
      <div class="lang-group">
        <a href="language-learning.html" class="game-nav-button">Vietnamese Vocabulary</a>
      </div>
      <div class="lang-group">
        <a href="language-learning-zh.html" class="game-nav-button">Chinese Vocabulary</a>
      </div>
      <div class="lang-group">
        <a href="language-learning-ko.html" class="game-nav-button">Korean Vocabulary</a>
      </div>
      <div class="lang-group">
        <a href="language-learning-fr.html" class="game-nav-button">French Vocabulary</a>
      </div>
    </div>

    <input type="text" class="search-box" id="searchBox" placeholder="Search vocabulary...">

    <div class="vocab-grid" id="vocabGrid"></div>
    <div class="no-results" id="noResults" style="display: none;">No vocabulary found matching your search.</div>
  </div>

<script>
const VOCABULARY = [
  {
    vi: "tÃ­ch cá»±c",
    en: "positive",
    zh: "ç§¯æžçš„",
    zhPinyin: "jÄ« jÃ­ de",
    fr: "positif, positive"
  },
  {
    vi: "láº¡c quan",
    en: "optimistic",
    zh: "ä¹è§‚çš„",
    zhPinyin: "lÃ¨ guÄn de",
    fr: "optimiste"
  },
  {
    vi: "dÃ i",
    en: "long",
    zh: "é•¿çš„",
    zhPinyin: "chÃ¡ng de",
    fr: "long, longue"
  },
  {
    vi: "ngáº¯n",
    en: "short",
    zh: "çŸ­çš„",
    zhPinyin: "duÇŽn de",
    fr: "court, courte"
  },
  {
    vi: "hiá»‡n Ä‘áº¡i",
    en: "modern",
    zh: "çŽ°ä»£çš„",
    zhPinyin: "xiÃ n dÃ i de",
    fr: "moderne"
  },
  {
    vi: "hoÃ n háº£o",
    en: "perfect",
    zh: "å®Œç¾Žçš„",
    zhPinyin: "wÃ¡n mÄ›i de",
    fr: "parfait, parfaite"
  },
  {
    vi: "Ä‘á»™c láº­p",
    en: "independent, independence",
    zh: "ç‹¬ç«‹çš„ / ç‹¬ç«‹",
    zhPinyin: "dÃº lÃ¬ de / dÃº lÃ¬",
    fr: "indÃ©pendant, indÃ©pendante / indÃ©pendance"
  },
  {
    vi: "nghÃ¨o",
    en: "poor",
    zh: "è´«ç©·çš„",
    zhPinyin: "pÃ­n qiÃ³ng de",
    fr: "pauvre"
  },
  {
    vi: "nguy hiá»ƒm",
    en: "dangerous",
    zh: "å±é™©çš„",
    zhPinyin: "wÄ“i xiÇŽn de",
    fr: "dangereux, dangereuse"
  },
  {
    vi: "xa xá»‰",
    en: "luxurious",
    zh: "å¥¢ä¾ˆçš„",
    zhPinyin: "shÄ“ chÇ de",
    fr: "luxueux, luxueuse"
  },
  {
    vi: "má»›i",
    en: "new",
    zh: "æ–°çš„",
    zhPinyin: "xÄ«n de",
    fr: "nouveau, nouvelle"
  },
  {
    vi: "cÅ©",
    en: "are old, old, former",
    zh: "æ—§çš„ / è€çš„",
    zhPinyin: "jiÃ¹ de / lÇŽo de",
    fr: "vieux, vieille / ancien, ancienne"
  },
  {
    vi: "cáº§n thiáº¿t",
    en: "necessary",
    zh: "å¿…è¦çš„",
    zhPinyin: "bÃ¬ yÃ o de",
    fr: "nÃ©cessaire"
  },
  {
    vi: "kiÃªn nháº«n",
    en: "patient",
    zh: "è€å¿ƒçš„",
    zhPinyin: "nÃ i xÄ«n de",
    fr: "patient, patiente"
  },
  {
    vi: "Ä‘áº¯t",
    en: "expensive",
    zh: "æ˜‚è´µçš„",
    zhPinyin: "Ã¡ng guÃ¬ de",
    fr: "cher, chÃ¨re"
  },
  {
    vi: "trung thá»±c",
    en: "honest",
    zh: "è¯šå®žçš„",
    zhPinyin: "chÃ©ng shÃ­ de",
    fr: "honnÃªte"
  },
  {
    vi: "quan trá»ng",
    en: "is important, important, was important",
    zh: "é‡è¦çš„",
    zhPinyin: "zhÃ²ng yÃ o de",
    fr: "important, importante"
  },
  {
    vi: "hÃ i hÆ°á»›c",
    en: "humorous, funny",
    zh: "å¹½é»˜çš„ / æœ‰è¶£çš„",
    zhPinyin: "yÅu mÃ² de / yÇ’u qÃ¹ de",
    fr: "humoristique, drÃ´le"
  },
  {
    vi: "cháº­m",
    en: "slow, slowly (when placed after verb), late",
    zh: "æ…¢çš„ / æ…¢",
    zhPinyin: "mÃ n de / mÃ n",
    fr: "lent, lente / lentement"
  },
  {
    vi: "háº¡nh phÃºc",
    en: "happiness, happy",
    zh: "å¹¸ç¦ / å¹¸ç¦çš„",
    zhPinyin: "xÃ¬ng fÃº / xÃ¬ng fÃº de",
    fr: "bonheur / heureux, heureuse"
  },
  {
    vi: "Ä‘Æ¡n giáº£n",
    en: "simple",
    zh: "ç®€å•çš„",
    zhPinyin: "jiÇŽn dÄn de",
    fr: "simple"
  },
  {
    vi: "nhanh",
    en: "fast, (can be adjective or adverb)",
    zh: "å¿«çš„ / å¿«",
    zhPinyin: "kuÃ i de / kuÃ i",
    fr: "rapide / rapidement"
  },
  {
    vi: "phá»©c táº¡p",
    en: "complicated",
    zh: "å¤æ‚çš„",
    zhPinyin: "fÃ¹ zÃ¡ de",
    fr: "compliquÃ©, compliquÃ©e"
  },
  {
    vi: "nhá»",
    en: "small, little",
    zh: "å°çš„",
    zhPinyin: "xiÇŽo de",
    fr: "petit, petite"
  },
  {
    vi: "lá»›n",
    en: "large, big, great",
    zh: "å¤§çš„",
    zhPinyin: "dÃ  de",
    fr: "grand, grande"
  },
  {
    vi: "dá»…",
    en: "easy",
    zh: "å®¹æ˜“çš„",
    zhPinyin: "rÃ³ng yÃ¬ de",
    fr: "facile"
  },
  {
    vi: "Ä‘áº·c biá»‡t",
    en: "special, especially",
    zh: "ç‰¹åˆ«çš„ / ç‰¹åˆ«",
    zhPinyin: "tÃ¨ biÃ© de / tÃ¨ biÃ©",
    fr: "spÃ©cial, spÃ©ciale / spÃ©cialement"
  },
  {
    vi: "ngon",
    en: "delicious, deliciously",
    zh: "ç¾Žå‘³çš„ / ç¾Žå‘³åœ°",
    zhPinyin: "mÄ›i wÃ¨i de / mÄ›i wÃ¨i de",
    fr: "dÃ©licieux, dÃ©licieuse / dÃ©licieusement"
  },
  {
    vi: "khÃ³",
    en: "hard, difficult",
    zh: "å›°éš¾çš„",
    zhPinyin: "kÃ¹n nÃ¡n de",
    fr: "difficile"
  },
  {
    vi: "Ä‘áº­m",
    en: "dark, deep",
    zh: "æ·±çš„ / æš—çš„",
    zhPinyin: "shÄ“n de / Ã n de",
    fr: "foncÃ©, foncÃ©e / profond, profonde"
  },
  {
    vi: "há»“ng",
    en: "pink",
    zh: "ç²‰è‰²çš„",
    zhPinyin: "fÄ›n sÃ¨ de",
    fr: "rose"
  },
  {
    vi: "vÃ ng",
    en: "yellow, gold",
    zh: "é»„è‰²çš„ / é‡‘è‰²",
    zhPinyin: "huÃ¡ng sÃ¨ de / jÄ«n sÃ¨",
    fr: "jaune / or"
  },
  {
    vi: "nháº¡t",
    en: "light",
    zh: "æµ…çš„",
    zhPinyin: "qiÇŽn de",
    fr: "clair, claire"
  },
  {
    vi: "tÃ­m",
    en: "purple, violet",
    zh: "ç´«è‰²çš„",
    zhPinyin: "zÇ sÃ¨ de",
    fr: "violet, violette"
  },
  {
    vi: "nÃ¢u",
    en: "brown",
    zh: "æ£•è‰²çš„",
    zhPinyin: "zÅng sÃ¨ de",
    fr: "marron"
  },
  {
    vi: "xÃ¡m",
    en: "gray, grey",
    zh: "ç°è‰²çš„",
    zhPinyin: "huÄ« sÃ¨ de",
    fr: "gris, grise"
  },
  {
    vi: "xanh lÃ¡ cÃ¢y",
    en: "green",
    zh: "ç»¿è‰²çš„",
    zhPinyin: "lÇœ sÃ¨ de",
    fr: "vert, verte"
  },
  {
    vi: "xanh da trá»i",
    en: "blue",
    zh: "è“è‰²çš„",
    zhPinyin: "lÃ¡n sÃ¨ de",
    fr: "bleu, bleue"
  },
  {
    vi: "Ä‘á»",
    en: "red",
    zh: "çº¢è‰²çš„",
    zhPinyin: "hÃ³ng sÃ¨ de",
    fr: "rouge"
  },
  {
    vi: "Ä‘en",
    en: "black",
    zh: "é»‘è‰²çš„",
    zhPinyin: "hÄ“i sÃ¨ de",
    fr: "noir, noire"
  },
  {
    vi: "tráº¯ng",
    en: "white",
    zh: "ç™½è‰²çš„",
    zhPinyin: "bÃ¡i sÃ¨ de",
    fr: "blanc, blanche"
  },
  {
    vi: "mÃ u",
    en: "color",
    zh: "é¢œè‰²",
    zhPinyin: "yÃ¡n sÃ¨",
    fr: "couleur"
  },
  {
    vi: "há»i",
    en: "ask, asks",
    zh: "é—®",
    zhPinyin: "wÃ¨n",
    fr: "demander"
  },
  {
    vi: "Ä‘Ã¡p Ã¡n",
    en: "answer",
    zh: "ç­”æ¡ˆ",
    zhPinyin: "dÃ¡ Ã n",
    fr: "rÃ©ponse"
  },
  {
    vi: "cÃ¢u",
    en: "sentence",
    zh: "å¥å­",
    zhPinyin: "jÃ¹ zi",
    fr: "phrase"
  },
  {
    vi: "tráº£ lá»i",
    en: "answer, respond, answers",
    zh: "å›žç­”",
    zhPinyin: "huÃ­ dÃ¡",
    fr: "rÃ©pondre, rÃ©ponse"
  },
  {
    vi: "nhÆ°",
    en: "like, as",
    zh: "åƒ / å¦‚",
    zhPinyin: "xiÃ ng / rÃº",
    fr: "comme"
  },
  {
    vi: "tháº¿ nÃ o",
    en: "how, how were, how was",
    zh: "æ€Žä¹ˆæ ·",
    zhPinyin: "zÄ›n me yÃ ng",
    fr: "comment"
  },
  {
    vi: "nhiÃªu",
    en: "much",
    zh: "å¤šå°‘",
    zhPinyin: "duÅ shÇŽo",
    fr: "beaucoup"
  },
  {
    vi: "lÃ m sao",
    en: "how",
    zh: "æ€Žä¹ˆ",
    zhPinyin: "zÄ›n me",
    fr: "comment"
  }
];

const LANGUAGE_HINTS = {
  vi: "vi-VN",
  en: "en-US",
  zh: "zh-CN",
  fr: "fr-FR",
  ko: "ko-KR"
};

let currentFilter = "all";
let searchTerm = "";
let preferredVoices = {};

function initVoices() {
  if (!("speechSynthesis" in window)) return;
  
  const voices = window.speechSynthesis.getVoices();
  if (!voices.length) return;

  Object.keys(LANGUAGE_HINTS).forEach(lang => {
    const hint = LANGUAGE_HINTS[lang];
    let langGroup = voices.filter(v => v.lang && v.lang.startsWith(hint));
    
    if (lang === "fr") {
      // PRIORITY 1: Female Natural/Neural French voices
      const femaleNaturalFr = langGroup.filter(v => {
        const name = v.name.toLowerCase();
        const isFemale = name.includes("female") || name.includes("f") || 
                        name.includes("woman") || name.includes("denise") ||
                        name.includes("hÃ©lÃ¨ne") || name.includes("zira") ||
                        (v.gender && v.gender.toLowerCase() === "female");
        const isNatural = name.includes("neural") || name.includes("natural") || 
                         name.includes("premium") || name.includes("enhanced");
        return isFemale && isNatural;
      });
      if (femaleNaturalFr.length) {
        preferredVoices[lang] = femaleNaturalFr[0];
        return;
      }
      
      // PRIORITY 2: Any Natural/Neural French voices
      const naturalFr = langGroup.filter(v => {
        const name = v.name.toLowerCase();
        return name.includes("neural") || name.includes("natural") || 
               name.includes("premium") || name.includes("enhanced");
      });
      if (naturalFr.length) {
        const femaleNatural = naturalFr.find(v => {
          const name = v.name.toLowerCase();
          return name.includes("female") || name.includes("f") || 
                 name.includes("woman") || name.includes("denise") ||
                 name.includes("hÃ©lÃ¨ne") ||
                 (v.gender && v.gender.toLowerCase() === "female");
        });
        preferredVoices[lang] = femaleNatural || naturalFr[0];
        return;
      }
      
      // PRIORITY 3: Female French voices
      const femaleFr = langGroup.filter(v => {
        const name = v.name.toLowerCase();
        return name.includes("female") || name.includes("f") || 
               name.includes("woman") || name.includes("denise") ||
               name.includes("hÃ©lÃ¨ne") ||
               (v.gender && v.gender.toLowerCase() === "female");
      });
      if (femaleFr.length) {
        preferredVoices[lang] = femaleFr[0];
        return;
      }
      
      // PRIORITY 4: Google French voices
      const googleFr = langGroup.filter(v => 
        v.name.toLowerCase().includes("google")
      );
      if (googleFr.length) {
        preferredVoices[lang] = googleFr[0];
        return;
      }
      
      // Fallback: any French voice
      if (langGroup.length) {
        preferredVoices[lang] = langGroup[0];
        return;
      }
    }
    
    if (lang === "en") {
      // PRIORITY 1: Female Natural/Neural voices (best quality, natural sound)
      const femaleNaturalEn = langGroup.filter(v => {
        const name = v.name.toLowerCase();
        const isFemale = name.includes("female") || name.includes("f") || 
                        name.includes("woman") || name.includes("zira") ||
                        name.includes("aria") || name.includes("susan") ||
                        name.includes("hazel") || name.includes("linda") ||
                        (v.gender && v.gender.toLowerCase() === "female");
        const isNatural = name.includes("neural") || name.includes("natural") || 
                         name.includes("premium") || name.includes("enhanced") ||
                         name.includes("online") || name.includes("aria");
        return isFemale && isNatural;
      });
      if (femaleNaturalEn.length) {
        preferredVoices[lang] = femaleNaturalEn[0];
        return;
      }
      
      // PRIORITY 2: Any Natural/Neural voices (preferring female)
      const naturalEn = langGroup.filter(v => {
        const name = v.name.toLowerCase();
        return name.includes("neural") || name.includes("natural") || 
               name.includes("premium") || name.includes("enhanced") ||
               name.includes("online") || name.includes("aria");
      });
      if (naturalEn.length) {
        const femaleNatural = naturalEn.find(v => {
          const name = v.name.toLowerCase();
          return name.includes("female") || name.includes("f") || 
                 name.includes("woman") || name.includes("zira") ||
                 name.includes("aria") || name.includes("susan") ||
                 name.includes("hazel") || name.includes("linda") ||
                 (v.gender && v.gender.toLowerCase() === "female");
        });
        preferredVoices[lang] = femaleNatural || naturalEn[0];
        return;
      }
      
      // PRIORITY 3: High-quality female voices
      const qualityFemaleEn = langGroup.filter(v => {
        const name = v.name.toLowerCase();
        return (name.includes("aria") && name.includes("online")) ||
               (name.includes("google") && name.includes("female")) ||
               name.includes("zira") || name.includes("susan") ||
               name.includes("hazel") || name.includes("linda") ||
               (name.includes("female") && (name.includes("us") || name.includes("uk")));
      });
      if (qualityFemaleEn.length) {
        preferredVoices[lang] = qualityFemaleEn[0];
        return;
      }
      
      // PRIORITY 4: Any female English voice
      const femaleEn = langGroup.filter(v => {
        const name = v.name.toLowerCase();
        return name.includes("female") || name.includes("f") || 
               name.includes("woman") ||
               (v.gender && v.gender.toLowerCase() === "female");
      });
      if (femaleEn.length) {
        preferredVoices[lang] = femaleEn[0];
        return;
      }
      
      // PRIORITY 5: Google English voices
      const googleEn = langGroup.filter(v => 
        v.name.toLowerCase().includes("google")
      );
      if (googleEn.length) {
        preferredVoices[lang] = googleEn[0];
        return;
      }
      
      // Fallback: any English voice
      if (langGroup.length) {
        preferredVoices[lang] = langGroup[0];
        return;
      }
    }
    
    // For other languages (Vietnamese, Chinese), prefer female natural voices too
    if (langGroup.length) {
      const femaleNatural = langGroup.find(v => {
        const name = v.name.toLowerCase();
        const isFemale = name.includes("female") || name.includes("f") || 
                        name.includes("woman") ||
                        (v.gender && v.gender.toLowerCase() === "female");
        const isNatural = name.includes("neural") || name.includes("natural") || 
                         name.includes("premium") || name.includes("enhanced");
        return isFemale && isNatural;
      });
      preferredVoices[lang] = femaleNatural || langGroup[0];
    } else {
      preferredVoices[lang] = voices.find(v => v.lang && v.lang.startsWith(lang)) || voices[0];
    }
  });
  
  if (preferredVoices.fr) {
    console.log('Selected French voice:', preferredVoices.fr.name, preferredVoices.fr.lang);
  }
  if (preferredVoices.en) {
    console.log('Selected English voice:', preferredVoices.en.name, preferredVoices.en.lang);
  }
}

if ("speechSynthesis" in window) {
  const loadVoices = () => {
    const voices = window.speechSynthesis.getVoices();
    if (voices.length > 0) {
      initVoices();
    } else {
      setTimeout(loadVoices, 100);
    }
  };
  
  window.speechSynthesis.onvoiceschanged = () => {
    loadVoices();
  };
  loadVoices();
  
  const initializeVoicesOnInteraction = () => {
    const voices = window.speechSynthesis.getVoices();
    if (voices.length > 0) {
      initVoices();
    } else {
      setTimeout(() => {
        const retryVoices = window.speechSynthesis.getVoices();
        if (retryVoices.length > 0) {
          initVoices();
        }
      }, 200);
    }
  };
  
  document.addEventListener('touchstart', initializeVoicesOnInteraction);
  document.addEventListener('click', initializeVoicesOnInteraction);
  document.addEventListener('mousedown', initializeVoicesOnInteraction);
}

function speakWord(text, lang) {
  if (!("speechSynthesis" in window)) {
    console.log('Speech synthesis not available');
    return;
  }
  
  try {
    window.speechSynthesis.cancel();
  } catch (e) {
    console.log('Error canceling speech:', e);
  }
  
  setTimeout(() => {
    const voices = window.speechSynthesis.getVoices();
    
    if (voices.length > 0) {
      if (!preferredVoices[lang] || Object.keys(preferredVoices).length === 0) {
        initVoices();
      }
    }
    
    const freshVoices = window.speechSynthesis.getVoices();
    if (freshVoices.length === 0) {
      console.log('No voices available');
      return;
    }
    
    const utterance = new SpeechSynthesisUtterance(text);
    
    if (lang === "fr") {
      utterance.rate = 0.9;
      utterance.pitch = 1.0;
      utterance.volume = 1.0;
    } else if (lang === "en") {
      utterance.rate = 0.9;
      utterance.pitch = 1.0;
      utterance.volume = 1.0;
    } else {
      utterance.rate = 0.95;
      utterance.pitch = 1.0;
      utterance.volume = 1.0;
    }
    
    utterance.lang = LANGUAGE_HINTS[lang] || lang;
    
    let voice = preferredVoices[lang];
    if (!voice) {
      const hint = LANGUAGE_HINTS[lang];
      const langGroup = freshVoices.filter(v => v.lang && v.lang.startsWith(hint || lang));
      voice = langGroup[0] || freshVoices.find(v => v.lang && v.lang.startsWith(lang)) || freshVoices[0];
    }
    
    if (voice) {
      try {
        utterance.voice = voice;
        utterance.lang = voice.lang || LANGUAGE_HINTS[lang] || lang;
      } catch (e) {
        console.log('Error setting voice:', e);
      }
    }
    
    utterance.onerror = (e) => {
      console.log('Speech error:', e, 'for language:', lang);
    };
    
    try {
      if (window.speechSynthesis.paused) {
        window.speechSynthesis.resume();
      }
      
      window.speechSynthesis.speak(utterance);
    } catch (e) {
      console.log('Error speaking:', e);
      setTimeout(() => {
        try {
          window.speechSynthesis.cancel();
          window.speechSynthesis.speak(utterance);
        } catch (retryError) {
          console.log('Final retry failed:', retryError);
        }
      }, 100);
    }
  }, 50);
}

function matchesFilter(vocab) {
  const searchLower = searchTerm.toLowerCase();
  const matchesSearch = !searchTerm || 
    vocab.fr.toLowerCase().includes(searchLower) ||
    vocab.en.toLowerCase().includes(searchLower) ||
    vocab.vi.toLowerCase().includes(searchLower) ||
    vocab.zh.toLowerCase().includes(searchLower) ||
    (vocab.ko && vocab.ko.toLowerCase().includes(searchLower)) ||
    (vocab.zhPinyin && vocab.zhPinyin.toLowerCase().includes(searchLower));
  
  if (!matchesSearch) return false;
  
  // If filter is "all", show all matching items
  if (currentFilter === "all") return true;
  
  // Filter by language - all vocabulary items have all languages, so just return true
  // The filter is mainly for visual organization, but we keep the logic for consistency
  return true;
}

function renderVocab() {
  const grid = document.getElementById("vocabGrid");
  const noResults = document.getElementById("noResults");
  const filtered = VOCABULARY.filter(matchesFilter);
  
  if (filtered.length === 0) {
    grid.innerHTML = "";
    noResults.style.display = "block";
    return;
  }
  
  noResults.style.display = "none";
  grid.innerHTML = filtered.map(vocab => `
    <div class="vocab-card">
      <div class="vocab-word">${vocab.fr}</div>
      <div class="vocab-translations">
        <div class="translation-row">
          <span class="lang-label">FR:</span>
          <span class="lang-content">${vocab.fr}</span>
          <button class="play-button" onclick="speakWord('${vocab.fr.split(',')[0].trim().split(' / ')[0].trim().replace(/'/g, "\\'")}', 'fr')" title="Listen">â–¶</button>
        </div>
        <div class="translation-row">
          <span class="lang-label">EN:</span>
          <span class="lang-content">${vocab.en}</span>
          <button class="play-button" onclick="speakWord('${vocab.en.split(',')[0].trim().replace(/'/g, "\\'")}', 'en')" title="Listen">â–¶</button>
        </div>
        <div class="translation-row">
          <span class="lang-label">VI:</span>
          <span class="lang-content">${vocab.vi}</span>
          <button class="play-button" onclick="speakWord('${vocab.vi.replace(/'/g, "\\'")}', 'vi')" title="Listen">â–¶</button>
        </div>
        <div class="translation-row">
          <span class="lang-label">ZH:</span>
          <div class="lang-content">
            ${vocab.zh}
            ${vocab.zhPinyin ? `<div class="pinyin">${vocab.zhPinyin}</div>` : ''}
          </div>
          <button class="play-button" onclick="speakWord('${vocab.zh.replace(/'/g, "\\'")}', 'zh')" title="Listen">â–¶</button>
        </div>
        ${vocab.ko ? `
        <div class="translation-row">
          <span class="lang-label">KO:</span>
          <span class="lang-content">${vocab.ko}</span>
          <button class="play-button" onclick="speakWord('${vocab.ko.split(',')[0].trim().replace(/'/g, "\\'")}', 'ko')" title="Listen">â–¶</button>
        </div>
        ` : ''}
      </div>
    </div>
  `).join("");
}

// Search box
const searchBox = document.getElementById('searchBox');
if (searchBox) {
  searchBox.addEventListener('input', (e) => {
    searchTerm = e.target.value;
    renderVocab();
  });
}

// Initial render
renderVocab();

// Make speakWord globally available
window.speakWord = speakWord;
</script>

<!-- html2pdf.js library for PDF generation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
async function downloadPDF() {
  // Show loading message
  const originalText = event.target.textContent;
  event.target.textContent = "â³ Generating PDF...";
  event.target.disabled = true;
  
  try {
    // Create a completely clean HTML structure for PDF (separate from webpage)
    const pdfContainer = document.createElement('div');
    pdfContainer.style.cssText = `
      background: #ffffff;
      color: #000000;
      font-family: Arial, sans-serif;
      padding: 20px;
      width: 100%;
    `;
    
    // Create clean grid for vocabulary cards
    const grid = document.createElement('div');
    grid.style.cssText = `
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      width: 100%;
    `;
    
    // Build vocabulary cards from data (not from webpage DOM)
    VOCABULARY.forEach(vocab => {
      const card = document.createElement('div');
      card.style.cssText = `
        background: transparent;
        border: none;
        border-bottom: 1px solid #e0e0e0;
        padding: 15px 0;
        color: #000000;
        page-break-inside: avoid;
      `;
      
      // Main word (French for this page)
      const wordDiv = document.createElement('div');
      wordDiv.style.cssText = `
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 10px;
        color: #000000;
      `;
      wordDiv.textContent = vocab.fr.split(',')[0].trim();
      card.appendChild(wordDiv);
      
      // Translations
      const translationsDiv = document.createElement('div');
      translationsDiv.style.cssText = `
        display: flex;
        flex-direction: column;
        gap: 5px;
        color: #000000;
      `;
      
      // French
      const frRow = document.createElement('div');
      frRow.style.cssText = 'color: #000000;';
      frRow.innerHTML = `<strong>FR:</strong> ${vocab.fr}`;
      translationsDiv.appendChild(frRow);
      
      // English
      const enRow = document.createElement('div');
      enRow.style.cssText = 'color: #000000;';
      enRow.innerHTML = `<strong>EN:</strong> ${vocab.en}`;
      translationsDiv.appendChild(enRow);
      
      // Vietnamese
      const viRow = document.createElement('div');
      viRow.style.cssText = 'color: #000000;';
      viRow.innerHTML = `<strong>VI:</strong> ${vocab.vi}`;
      translationsDiv.appendChild(viRow);
      
      // Chinese
      const zhRow = document.createElement('div');
      zhRow.style.cssText = 'color: #000000;';
      zhRow.innerHTML = `<strong>ZH:</strong> ${vocab.zh}${vocab.zhPinyin ? `<br><span style="font-size: 12px; margin-left: 30px;">${vocab.zhPinyin}</span>` : ''}`;
      translationsDiv.appendChild(zhRow);
      
      // Korean (if exists)
      if (vocab.ko) {
        const koRow = document.createElement('div');
        koRow.style.cssText = 'color: #000000;';
        koRow.innerHTML = `<strong>KO:</strong> ${vocab.ko}`;
        translationsDiv.appendChild(koRow);
      }
      
      card.appendChild(translationsDiv);
      grid.appendChild(card);
    });
    
    pdfContainer.appendChild(grid);
    
    // Temporarily add to body (hidden)
    pdfContainer.style.position = 'absolute';
    pdfContainer.style.left = '-9999px';
    document.body.appendChild(pdfContainer);
    
    const opt = {
      margin: [10, 10, 10, 10],
      filename: 'language-learning-french-vocabulary.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { 
        scale: 2,
        useCORS: true,
        backgroundColor: '#ffffff'
      },
      jsPDF: { 
        unit: 'mm', 
        format: 'a4', 
        orientation: 'portrait' 
      }
    };
    
    // Generate PDF from clean structure
    await html2pdf().set(opt).from(pdfContainer).save();
    
    // Remove temporary element
    document.body.removeChild(pdfContainer);
    
    // Restore button
    event.target.textContent = originalText;
    event.target.disabled = false;
  } catch (error) {
    console.error('Error generating PDF:', error);
    alert('Error generating PDF. Please try again.');
    event.target.textContent = originalText;
    event.target.disabled = false;
  }
}
</script>
</body>
</html>

