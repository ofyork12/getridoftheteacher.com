{
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- These kill ALL caching forever ‚Äì latest version every refresh -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Get Rid of the Teacher</title>
  <style>
    :root {
      --circle-size: clamp(90px, 18vw, 170px);   /* inside color */
      --circle-border: clamp(8px, 1.4vw, 12px);
      --circle-total: calc(var(--circle-size) + var(--circle-border) * 2);
      --circle-radius: calc(var(--circle-total) / 2);
      --triangle-rise: calc(var(--circle-total) * 0.8660254);
      --section-gap: clamp(50px, 10vw, 90px);
    }
    body {
      margin: 0;
      min-height: 100vh;
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--section-gap);
      padding: 40px 12px 120px;
      overflow-y: auto;
      -webkit-tap-highlight-color: transparent;
    }
    .set {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      width: 100%;
      text-align: center;
    }
    .set > :last-child {
      margin: 0 auto;
    }
    .set h2 {
      margin: 0;
      font-size: 28px;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 30px;
      justify-content: center;
    }
    .lang-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .controls button {
      padding: 10px 20px;
      border: 2px solid #fff;
      border-radius: 999px;
      background: transparent;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s ease, color 0.3s ease;
    }
    .controls button.active {
      background: #fff;
      color: #000;
    }
    .controls button.dual {
      font-size: 13px;
      padding: 6px 14px;
      opacity: 0.85;
      border-style: dashed;
    }

    .circle {
      width: var(--circle-total);
      height: var(--circle-total);
      border-radius: 50%;
      background: #222;
      border: var(--circle-border) solid #fff;
      cursor: pointer;
      transition: background 0.25s ease;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      outline: none;
    }
    .circle:focus-visible,
    .circle:focus,
    .circle:active {
      outline: none;
    }
    .circle.red        { background: #ff0000; }
    .circle.orange     { background: #ff6200; }
    .circle.yellow     { background: #ffe600; }
    .circle.green      { background: #00a12c; }
    .circle.blue       { background: #0030ff; }
    .circle.purple     { background: #8b3dff; }
    .circle.brown      { background: #7a3b00; }
    .circle.pink       { background: #ff3fa6; }
    .circle.sky        { background: #38c7ff; }
    .circle.red-final  { background: #ff0000; }

    .pair {
      display: flex;
      align-items: center;
      gap: 0;
    }
    .pair .circle + .circle {
      margin-left: 0;           /* no overlap ‚Äì just touching */
    }

    .stack-three {
      position: relative;
      width: calc(var(--circle-total) * 2);
      height: calc(var(--triangle-rise) + var(--circle-total));
    }
    .stack-three .circle {
      position: absolute;
    }
    .stack-three .bottom-left {
      left: 0;
      bottom: 0;
    }
    .stack-three .bottom-right {
      left: var(--circle-total);
      bottom: 0;
    }
    .stack-three .top {
      left: var(--circle-total);
      bottom: var(--triangle-rise);
      transform: translateX(-50%);
    }

    .stack-four {
      position: relative;
      width: calc(var(--circle-total) * 2);
      height: calc(var(--circle-total) * 2);
    }
    .stack-four .circle {
      position: absolute;
    }
    .stack-four .top-left {
      top: 0;
      left: 0;
    }
    .stack-four .top-right {
      top: 0;
      left: var(--circle-total);
    }
    .stack-four .bottom-left {
      top: var(--circle-total);
      left: 0;
    }
    .stack-four .bottom-right {
      top: var(--circle-total);
      left: var(--circle-total);
    }

    .stack-five {
      position: relative;
      width: calc(var(--circle-total) * 3);
      height: calc(var(--triangle-rise) + var(--circle-total));
    }
    .stack-five .circle {
      position: absolute;
    }
    .stack-five .row2-left {
      left: calc(var(--circle-total) / 2);
      bottom: var(--triangle-rise);
    }
    .stack-five .row2-right {
      left: calc(var(--circle-total) * 1.5);
      bottom: var(--triangle-rise);
    }
    .stack-five .row1-left {
      left: 0;
      bottom: 0;
    }
    .stack-five .row1-center {
      left: var(--circle-total);
      bottom: 0;
    }
    .stack-five .row1-right {
      left: calc(var(--circle-total) * 2);
      bottom: 0;
    }

    .stack-six {
      position: relative;
      width: calc(var(--circle-total) * 3);
      height: calc(var(--triangle-rise) * 2 + var(--circle-total));
    }
    .stack-six .circle { position: absolute; }
    .stack-six .row1-left   { left: 0; bottom: 0; }
    .stack-six .row1-center { left: var(--circle-total); bottom: 0; }
    .stack-six .row1-right  { left: calc(var(--circle-total) * 2); bottom: 0; }
    .stack-six .row2-left   { left: calc(var(--circle-total) / 2); bottom: var(--triangle-rise); }
    .stack-six .row2-right  { left: calc(var(--circle-total) * 1.5); bottom: var(--triangle-rise); }
    .stack-six .row3 {
      left: calc(var(--circle-total) * 1.5);
      bottom: calc(var(--triangle-rise) * 2);
      transform: translateX(-50%);
    }

    .stack-seven {
      position: relative;
      width: calc(var(--circle-total) * 3);
      height: calc(var(--triangle-rise) * 2 + var(--circle-total));
    }
    .stack-seven .circle { position: absolute; }
    .stack-seven .top-left {
      left: calc(var(--circle-total) / 2);
      bottom: calc(var(--triangle-rise) * 2);
    }
    .stack-seven .top-right {
      left: calc(var(--circle-total) * 1.5);
      bottom: calc(var(--triangle-rise) * 2);
    }
    .stack-seven .mid-left {
      left: 0;
      bottom: var(--triangle-rise);
    }
    .stack-seven .mid-center {
      left: var(--circle-total);
      bottom: var(--triangle-rise);
    }
    .stack-seven .mid-right {
      left: calc(var(--circle-total) * 2);
      bottom: var(--triangle-rise);
    }
    .stack-seven .bottom-left {
      left: calc(var(--circle-total) / 2);
      bottom: 0;
    }
    .stack-seven .bottom-right {
      left: calc(var(--circle-total) * 1.5);
      bottom: 0;
    }

    .stack-eight {
      display: grid;
      grid-template-columns: repeat(3, var(--circle-total));
      grid-auto-rows: var(--circle-total);
      gap: 0;
      width: calc(var(--circle-total) * 3);
      height: calc(var(--circle-total) * 3);
      justify-items: center;
      align-items: center;
    }
    .stack-eight .circle,
    .stack-eight .gap {
      width: var(--circle-total);
      height: var(--circle-total);
    }
    .stack-eight .circle {
      position: static;
    }
    .stack-eight .gap {
      pointer-events: none;
    }

    .stack-nine {
      display: grid;
      grid-template-columns: repeat(3, var(--circle-total));
      grid-auto-rows: var(--circle-total);
      gap: 0;
      width: calc(var(--circle-total) * 3);
      height: calc(var(--circle-total) * 3);
      justify-items: center;
      align-items: center;
    }
    .stack-nine .circle {
      position: static;
    }

    .stack-ten {
      position: relative;
      width: calc(var(--circle-total) * 4);
      height: calc(var(--triangle-rise) * 3 + var(--circle-total));
    }
    .stack-ten .circle { position: absolute; }
    .stack-ten .row1-1 { left: 0; bottom: 0; }
    .stack-ten .row1-2 { left: var(--circle-total); bottom: 0; }
    .stack-ten .row1-3 { left: calc(var(--circle-total) * 2); bottom: 0; }
    .stack-ten .row1-4 { left: calc(var(--circle-total) * 3); bottom: 0; }
    .stack-ten .row2-1 { left: calc(var(--circle-total) / 2); bottom: var(--triangle-rise); }
    .stack-ten .row2-2 { left: calc(var(--circle-total) * 1.5); bottom: var(--triangle-rise); }
    .stack-ten .row2-3 { left: calc(var(--circle-total) * 2.5); bottom: var(--triangle-rise); }
    .stack-ten .row3-left {
      left: calc(var(--circle-total));
      bottom: calc(var(--triangle-rise) * 2);
    }
    .stack-ten .row3-right {
      left: calc(var(--circle-total) * 2);
      bottom: calc(var(--triangle-rise) * 2);
    }
    .stack-ten .row4 {
      left: calc(var(--circle-total) * 2);
      bottom: calc(var(--triangle-rise) * 3);
      transform: translateX(-50%);
    }

    /* Game Mode Styles */
    .game-mode-toggle {
      margin: 20px 0;
      padding: 15px 30px;
      font-size: 20px;
      font-weight: bold;
      background: #fff;
      color: #000;
      border: 3px solid #fff;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .game-mode-toggle:hover {
      background: #000;
      color: #fff;
    }
    .game-navigation {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      justify-content: center;
      flex-wrap: wrap;
    }
    .game-nav-button {
      padding: 15px 30px;
      font-size: 18px;
      font-weight: bold;
      background: transparent;
      color: #fff;
      border: 3px solid #fff;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }
    .game-nav-button:hover {
      background: #fff;
      color: #000;
    }
    .game-nav-button.active {
      background: #fff;
      color: #000;
    }

    .instructions {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      text-align: center;
      display: none;
    }
    .instructions.show {
      display: block;
    }
    .instructions h3 {
      font-size: 24px;
      margin-bottom: 15px;
      text-transform: uppercase;
    }
    .instructions p {
      font-size: 18px;
      line-height: 1.6;
      margin: 10px 0;
    }
    .instructions .lang-instructions {
      display: none;
    }
    .instructions .lang-instructions.active {
      display: block;
    }

    .game-area {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 30px;
      width: 100%;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
    }
    .game-area.show {
      display: flex;
    }

    .game-question {
      font-size: clamp(24px, 5vw, 36px);
      font-weight: bold;
      text-align: center;
      margin: 20px 0;
    }

    .game-questions-group {
      display: flex;
      flex-direction: column;
      gap: clamp(50px, 8vw, 80px);
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      overflow: visible;
      padding: 50px 0;
    }
    .game-questions-group.slide-out-left {
      animation: slideOutLeft 0.5s ease-in-out forwards;
    }
    .game-questions-group.slide-in-right {
      animation: slideInRight 0.5s ease-in-out forwards;
    }
    @keyframes slideOutLeft {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(-100%);
        opacity: 0;
      }
    }
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .game-question-row {
      display: flex;
      gap: clamp(20px, 5vw, 50px);
      justify-content: center;
      align-items: flex-end; /* All numbers align on same baseline */
      flex-wrap: nowrap;
      width: 100%;
      position: relative;
      transition: none !important;
      transform: none !important;
    }
    .game-question-row * {
      transition: none !important;
    }
    .game-question-row .game-option {
      flex-shrink: 0;
      flex-grow: 0;
    }

    .game-comparison-symbol {
      font-size: clamp(25px, 5vw, 50px);
      font-weight: bold;
      color: #fff;
      width: clamp(40px, 8vw, 80px);
      min-width: clamp(40px, 8vw, 80px);
      max-width: clamp(40px, 8vw, 80px);
      text-align: center;
      opacity: 0;
      visibility: hidden;
      align-self: center;
      z-index: 20; /* Above the green circle */
      position: relative;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
      flex-shrink: 0;
      flex-grow: 0;
      transition: none !important;
    }
    .game-comparison-symbol.show {
      opacity: 1;
      visibility: visible;
    }

    .game-score {
      text-align: center;
      margin: 20px 0;
      font-size: clamp(16px, 3vw, 24px);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .game-score-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }
    .game-score-label {
      font-size: 0.9em;
    }
    .game-score-display {
      position: relative;
      display: inline-block;
    }
    .game-score-triangle {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 0;
      height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-bottom: 26px solid rgba(255,255,255,0.3);
      pointer-events: none;
      z-index: 1;
    }
    .game-score-dots {
      position: relative;
      z-index: 2;
    }

    .game-group-complete {
      font-size: clamp(32px, 6vw, 48px);
      font-weight: bold;
      text-align: center;
      color: #00ff00;
      margin: 30px 0;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    .game-group-complete.show {
      opacity: 1;
    }

    .game-feedback {
      font-size: clamp(18px, 3.5vw, 28px);
      font-weight: bold;
      text-align: center;
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      margin: 0;
      min-height: 30px;
      opacity: 0;
      visibility: hidden;
      transition: none !important;
      pointer-events: none;
    }
    .game-feedback.show {
      opacity: 1;
      visibility: visible;
    }
    .game-feedback.correct {
      color: #00ff00;
    }
    .game-feedback.incorrect {
      color: #ff0000;
    }

    /* Recalculate sizes for game mode - all consistent */
    .game-option {
      position: relative;
      cursor: pointer;
      transition: none !important;
      transform: none !important;
      --game-circle-size: clamp(12px, 2.5vw, 25px);
      --game-circle-border: clamp(1px, 0.2vw, 2px); /* Thinner border */
      --game-circle-total: calc(var(--game-circle-size) + var(--game-circle-border) * 2);
      --game-triangle-rise: calc(var(--game-circle-total) * 0.8660254);
      display: flex;
      align-items: flex-end; /* Align all to same baseline */
    }
    .game-option * {
      transition: none !important;
    }

    /* Much smaller, consistent circles for game mode - ALL EXACTLY SAME SIZE */
    .game-option .circle {
      width: var(--game-circle-total) !important;
      height: var(--game-circle-total) !important;
      border-width: var(--game-circle-border) !important; /* Thinner border */
      box-sizing: border-box;
      margin: 0 !important;
      padding: 0 !important;
      transition: none !important;
      transform: none !important;
    }

    .game-option.pair {
      display: flex;
      gap: 0;
      align-items: flex-start;
    }

    .game-option.stack-three {
      position: relative;
      width: calc(var(--game-circle-total) * 2);
      height: calc(var(--game-triangle-rise) + var(--game-circle-total));
    }
    .game-option.stack-three .circle {
      position: absolute;
    }
    .game-option.stack-three .bottom-left {
      left: 0;
      bottom: 0;
    }
    .game-option.stack-three .bottom-right {
      left: var(--game-circle-total);
      bottom: 0;
    }
    .game-option.stack-three .top {
      left: calc(var(--game-circle-total) / 2);
      bottom: var(--game-triangle-rise);
    }

    .game-option.stack-four {
      position: relative;
      width: calc(var(--game-circle-total) * 2);
      height: calc(var(--game-circle-total) * 2);
    }
    .game-option.stack-four .circle {
      position: absolute;
    }
    .game-option.stack-four .top-left {
      top: 0;
      left: 0;
    }
    .game-option.stack-four .top-right {
      top: 0;
      left: var(--game-circle-total);
    }
    .game-option.stack-four .bottom-left {
      top: var(--game-circle-total);
      left: 0;
    }
    .game-option.stack-four .bottom-right {
      top: var(--game-circle-total);
      left: var(--game-circle-total);
    }

    .game-option.stack-five {
      position: relative;
      width: calc(var(--game-circle-total) * 3);
      height: calc(var(--game-triangle-rise) * 2 + var(--game-circle-total));
    }
    .game-option.stack-five .circle {
      position: absolute;
    }
    .game-option.stack-five .row2-left {
      left: calc(var(--game-circle-total) / 2);
      bottom: var(--game-triangle-rise);
    }
    .game-option.stack-five .row2-right {
      left: calc(var(--game-circle-total) * 1.5);
      bottom: var(--game-triangle-rise);
    }
    .game-option.stack-five .row1-left {
      left: 0;
      bottom: 0;
    }
    .game-option.stack-five .row1-center {
      left: var(--game-circle-total);
      bottom: 0;
    }
    .game-option.stack-five .row1-right {
      left: calc(var(--game-circle-total) * 2);
      bottom: 0;
    }

    .game-option.stack-six {
      position: relative;
      width: calc(var(--game-circle-total) * 3);
      height: calc(var(--game-triangle-rise) * 3 + var(--game-circle-total));
    }
    .game-option.stack-six .circle {
      position: absolute;
    }
    .game-option.stack-six .row1-left {
      left: 0;
      bottom: 0;
    }
    .game-option.stack-six .row1-center {
      left: var(--game-circle-total);
      bottom: 0;
    }
    .game-option.stack-six .row1-right {
      left: calc(var(--game-circle-total) * 2);
      bottom: 0;
    }
    .game-option.stack-six .row2-left {
      left: calc(var(--game-circle-total) / 2);
      bottom: var(--game-triangle-rise);
    }
    .game-option.stack-six .row2-right {
      left: calc(var(--game-circle-total) * 1.5);
      bottom: var(--game-triangle-rise);
    }
    .game-option.stack-six .row3 {
      left: calc(var(--game-circle-total) * 1.5 - var(--game-circle-total) / 2);
      bottom: calc(var(--game-triangle-rise) * 2);
    }

    .game-option.stack-seven {
      position: relative;
      width: calc(var(--game-circle-total) * 3);
      height: calc(var(--game-triangle-rise) * 2 + var(--game-circle-total));
    }
    .game-option.stack-seven .circle {
      position: absolute;
    }
    .game-option.stack-seven .top-left {
      left: calc(var(--game-circle-total) / 2);
      bottom: calc(var(--game-triangle-rise) * 2);
    }
    .game-option.stack-seven .top-right {
      left: calc(var(--game-circle-total) * 1.5);
      bottom: calc(var(--game-triangle-rise) * 2);
    }
    .game-option.stack-seven .mid-left {
      left: 0;
      bottom: var(--game-triangle-rise);
    }
    .game-option.stack-seven .mid-center {
      left: var(--game-circle-total);
      bottom: var(--game-triangle-rise);
    }
    .game-option.stack-seven .mid-right {
      left: calc(var(--game-circle-total) * 2);
      bottom: var(--game-triangle-rise);
    }
    .game-option.stack-seven .bottom-left {
      left: calc(var(--game-circle-total) / 2);
      bottom: 0;
    }
    .game-option.stack-seven .bottom-right {
      left: calc(var(--game-circle-total) * 1.5);
      bottom: 0;
    }

    .game-option.stack-eight {
      display: grid;
      grid-template-columns: repeat(3, var(--game-circle-total));
      grid-auto-rows: var(--game-circle-total);
      gap: 0;
      width: calc(var(--game-circle-total) * 3);
      height: calc(var(--game-circle-total) * 3);
      justify-items: start;
      align-items: start;
    }
    .game-option.stack-eight .circle,
    .game-option.stack-eight .gap {
      width: var(--game-circle-total);
      height: var(--game-circle-total);
    }
    .game-option.stack-eight .circle {
      position: static;
    }
    .game-option.stack-eight .gap {
      pointer-events: none;
    }

    .game-option.stack-nine {
      display: grid;
      grid-template-columns: repeat(3, var(--game-circle-total));
      grid-auto-rows: var(--game-circle-total);
      gap: 0;
      width: calc(var(--game-circle-total) * 3);
      height: calc(var(--game-circle-total) * 3);
      justify-items: start;
      align-items: start;
    }
    .game-option.stack-nine .circle {
      position: static;
    }

    .game-option.stack-ten {
      position: relative;
      width: calc(var(--game-circle-total) * 4);
      height: calc(var(--game-triangle-rise) * 3 + var(--game-circle-total));
    }
    /* Triangle outline using SVG for precise positioning */
    .game-option.stack-ten .triangle-svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 2;
    }
    .game-option.stack-ten.correct .triangle-svg {
      z-index: 2; /* Below green circle */
    }
    .game-option.stack-ten .triangle-svg line {
      stroke: #fff;
      stroke-width: 4;
      stroke-linecap: round;
    }
    .game-option.stack-ten .circle {
      position: absolute;
      z-index: 1; /* Below triangle lines */
    }
    .game-option.stack-ten .row1-1 {
      left: 0;
      bottom: 0;
    }
    .game-option.stack-ten .row1-2 {
      left: var(--game-circle-total);
      bottom: 0;
    }
    .game-option.stack-ten .row1-3 {
      left: calc(var(--game-circle-total) * 2);
      bottom: 0;
    }
    .game-option.stack-ten .row1-4 {
      left: calc(var(--game-circle-total) * 3);
      bottom: 0;
    }
    .game-option.stack-ten .row2-1 {
      left: calc(var(--game-circle-total) / 2);
      bottom: var(--game-triangle-rise);
    }
    .game-option.stack-ten .row2-2 {
      left: calc(var(--game-circle-total) * 1.5);
      bottom: var(--game-triangle-rise);
    }
    .game-option.stack-ten .row2-3 {
      left: calc(var(--game-circle-total) * 2.5);
      bottom: var(--game-triangle-rise);
    }
    .game-option.stack-ten .row3-left {
      left: var(--game-circle-total);
      bottom: calc(var(--game-triangle-rise) * 2);
    }
    .game-option.stack-ten .row3-right {
      left: calc(var(--game-circle-total) * 2);
      bottom: calc(var(--game-triangle-rise) * 2);
    }
    .game-option.stack-ten .row4 {
      left: calc(var(--game-circle-total) * 1.5);
      bottom: calc(var(--game-triangle-rise) * 3);
      transform: translateX(-50%);
    }
    .game-option {
      transition: none !important; /* Prevent any movement */
    }
    .game-option:hover {
      transform: none; /* No scaling on hover */
    }
    .game-option.selected {
      transform: none; /* No scaling when selected */
    }
    .game-option.correct::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      /* Use fixed size to ensure perfect circle */
      width: 120px;
      height: 120px;
      min-width: 120px;
      min-height: 120px;
      max-width: 120px;
      max-height: 120px;
      /* Force perfect circle */
      aspect-ratio: 1;
      border: 6px solid #00ff00;
      border-radius: 50%;
      opacity: 1;
      z-index: 3; /* Above triangle, below comparison symbol */
      pointer-events: none; /* Don't interfere with layout */
      transition: none !important;
      box-sizing: border-box;
    }
    /* For 6, adjust circle position - it's too low */
    .game-option.stack-six.correct::before {
      transform: translate(-50%, -45%); /* Move up slightly */
    }
    /* For 10, use a larger circle border (like other numbers) - no fill, no text */
    .game-option.stack-ten.correct::before {
      width: 150px;
      height: 150px;
      min-width: 150px;
      min-height: 150px;
      max-width: 150px;
      max-height: 150px;
      border: 6px solid #00ff00;
      background: transparent; /* No fill */
      border-radius: 50% !important;
      z-index: 3; /* Above triangle, below comparison symbol */
    }
    .game-option.incorrect::before {
      content: '';
      position: absolute;
      top: -20px;
      left: -20px;
      right: -20px;
      bottom: -20px;
      border: 8px solid #ff0000;
      border-radius: 50%;
      pointer-events: none; /* Don't interfere with layout */
      transform: none !important;
      transition: none !important;
    }

    .game-controls {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    .game-controls button {
      padding: 15px 30px;
      font-size: 18px;
      font-weight: bold;
      background: #fff;
      color: #000;
      border: 3px solid #fff;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .game-controls button:hover {
      background: #000;
      color: #fff;
    }
    .game-controls button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .practice-mode {
      display: block;
    }
    .practice-mode.hide {
      display: none;
    }
  </style>
</head>
<body>

  <div class="game-navigation">
    <a href="bigger-smaller.html" class="game-nav-button active">Bigger/Smaller</a>
    <a href="squares.html" class="game-nav-button">Squares</a>
    <button onclick="downloadPDF()" class="game-nav-button" style="cursor: pointer; border: none; background: transparent; color: #fff; font-size: inherit; font-family: inherit;">üì• Download PDF</button>
  </div>
  <button class="game-mode-toggle" id="gameToggle">üéÆ Play Game</button>

  <div class="instructions" id="instructions">
    <h3 id="instructionsTitle">How to Play</h3>
    <div class="lang-instructions active" data-lang="en">
      <p><strong>Which one is bigger?</strong></p>
      <p>Look at the two groups of dots. Click on the group that has MORE dots!</p>
      <p>When you get it right, you'll see a green circle around the answer.</p>
    </div>
    <div class="lang-instructions" data-lang="vi">
      <p><strong>C√°i n√†o l·ªõn h∆°n?</strong></p>
      <p>Nh√¨n v√†o hai nh√≥m ch·∫•m. Nh·∫•p v√†o nh√≥m c√≥ NHI·ªÄU ch·∫•m h∆°n!</p>
      <p>Khi b·∫°n tr·∫£ l·ªùi ƒë√∫ng, b·∫°n s·∫Ω th·∫•y m·ªôt v√≤ng tr√≤n m√†u xanh l√° c√¢y xung quanh c√¢u tr·∫£ l·ªùi.</p>
    </div>
    <div class="lang-instructions" data-lang="zh">
      <p><strong>Âì™‰∏™Êõ¥Â§ßÔºü</strong></p>
      <p>ÁúãËøô‰∏§ÁªÑÁÇπ„ÄÇÁÇπÂáªÊúâÊõ¥Â§öÁÇπÁöÑÈÇ£‰∏ÄÁªÑÔºÅ</p>
      <p>ÂΩì‰Ω†Á≠îÂØπÊó∂Ôºå‰Ω†‰ºöÁúãÂà∞Á≠îÊ°àÂë®Âõ¥Êúâ‰∏Ä‰∏™ÁªøËâ≤ÁöÑÂúÜÂúà„ÄÇ</p>
    </div>
    <div class="lang-instructions" data-lang="ko">
      <p><strong>Ïñ¥Îäê Í≤ÉÏù¥ Îçî ÌÅ∞Í∞ÄÏöî?</strong></p>
      <p>Îëê Í∑∏Î£πÏùò Ï†êÏùÑ Î≥¥ÏÑ∏Ïöî. Ï†êÏù¥ Îçî ÎßéÏùÄ Í∑∏Î£πÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî!</p>
      <p>Ï†ïÎãµÏùÑ ÎßûÏ∂îÎ©¥ Îãµ Ï£ºÏúÑÏóê Ï¥àÎ°ùÏÉâ ÏõêÏù¥ ÎÇòÌÉÄÎÇ©ÎãàÎã§.</p>
    </div>
    <div class="lang-instructions" data-lang="es">
      <p><strong>¬øCu√°l es m√°s grande?</strong></p>
      <p>Mira los dos grupos de puntos. ¬°Haz clic en el grupo que tiene M√ÅS puntos!</p>
      <p>Cuando lo hagas bien, ver√°s un c√≠rculo verde alrededor de la respuesta.</p>
    </div>
    <div class="lang-instructions" data-lang="fr">
      <p><strong>Lequel est plus grand?</strong></p>
      <p>Regardez les deux groupes de points. Cliquez sur le groupe qui a PLUS de points!</p>
      <p>Quand vous avez raison, vous verrez un cercle vert autour de la r√©ponse.</p>
    </div>
    <div class="lang-instructions" data-lang="hi">
      <p><strong>‡§ï‡•å‡§® ‡§∏‡§æ ‡§¨‡§°‡§º‡§æ ‡§π‡•à?</strong></p>
      <p>‡§¶‡•ã ‡§∏‡§Æ‡•Ç‡§π‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§ø‡§Ç‡§¶‡•Å‡§ì‡§Ç ‡§ï‡•ã ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§ ‡§ú‡§ø‡§∏ ‡§∏‡§Æ‡•Ç‡§π ‡§Æ‡•á‡§Ç ‡§Ö‡§ß‡§ø‡§ï ‡§¨‡§ø‡§Ç‡§¶‡•Å ‡§π‡•à‡§Ç, ‡§â‡§∏ ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç!</p>
      <p>‡§ú‡§¨ ‡§Ü‡§™ ‡§∏‡§π‡•Ä ‡§π‡•ã‡§Ç‡§ó‡•á, ‡§§‡•ã ‡§Ü‡§™‡§ï‡•ã ‡§â‡§§‡•ç‡§§‡§∞ ‡§ï‡•á ‡§ö‡§æ‡§∞‡•ã‡§Ç ‡§ì‡§∞ ‡§è‡§ï ‡§π‡§∞‡§æ ‡§µ‡•É‡§§‡•ç‡§§ ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á‡§ó‡§æ‡•§</p>
    </div>
  </div>

  <div class="game-area" id="gameArea">
    <div class="game-question" id="gameQuestion">Which one is bigger?</div>
    <div class="game-score" id="gameScore">
      <span>Score: </span>
      <span class="game-score-number" id="scoreCorrect"></span>
      <span> / </span>
      <span class="game-score-number" id="scoreTotal"></span>
    </div>
    <div class="game-questions-group" id="gameQuestionsGroup">
      <!-- 5 questions will be inserted here -->
    </div>
    <div class="game-group-complete" id="groupComplete">Great! üéâ</div>
    <div class="game-controls">
      <button id="backToPractice">‚Üê Back to Practice</button>
    </div>
  </div>

  <div class="practice-mode" id="practiceMode">
  <div class="controls" role="group" aria-label="Language selector">
    <div class="lang-group">
      <button data-lang="en" class="active">English</button>
      <button class="dual" data-mode="sound">Sound</button>
    </div>
    <div class="lang-group">
      <button data-lang="vi">Ti·∫øng Vi·ªát</button>
      <button class="dual" data-dual="vi">Ti·∫øng Vi·ªát + English</button>
    </div>
    <div class="lang-group">
      <button data-lang="zh">‰∏≠Êñá</button>
      <button class="dual" data-dual="zh">‰∏≠Êñá + English</button>
    </div>
    <div class="lang-group">
      <button data-lang="ko">ÌïúÍµ≠Ïñ¥</button>
      <button class="dual" data-dual="ko">ÌïúÍµ≠Ïñ¥ + English</button>
    </div>
    <div class="lang-group">
      <button data-lang="es">Espa√±ol</button>
      <button class="dual" data-dual="es">Espa√±ol + English</button>
    </div>
    <div class="lang-group">
      <button data-lang="fr">Fran√ßais</button>
      <button class="dual" data-dual="fr">Fran√ßais + English</button>
    </div>
    <div class="lang-group">
      <button data-lang="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
      <button class="dual" data-dual="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä + English</button>
    </div>
  </div>

  <section class="set">
    <h2>Number 1</h2>
    <div class="circle" id="one"></div>
  </section>

  <section class="set">
    <h2>Number 2</h2>
    <div class="pair" id="two">
      <div class="circle"></div>
      <div class="circle"></div>
    </div>
  </section>

  <section class="set">
    <h2>Number 3</h2>
    <div class="stack-three" id="three">
      <div class="circle top"></div>
      <div class="circle bottom-left"></div>
      <div class="circle bottom-right"></div>
    </div>
  </section>

  <section class="set">
    <h2>Number 4</h2>
    <div class="stack-four" id="four">
      <div class="circle top-left"></div>
      <div class="circle top-right"></div>
      <div class="circle bottom-left"></div>
      <div class="circle bottom-right"></div>
    </div>
  </section>

  <section class="set">
    <h2>Number 5</h2>
    <div class="stack-five" id="five">
      <div class="circle row2-left"></div>
      <div class="circle row2-right"></div>
      <div class="circle row1-left"></div>
      <div class="circle row1-center"></div>
      <div class="circle row1-right"></div>
    </div>
  </section>

  <section class="set">
    <h2>Number 6</h2>
    <div class="stack-six" id="six">
      <div class="circle row3"></div>
      <div class="circle row2-left"></div>
      <div class="circle row2-right"></div>
      <div class="circle row1-left"></div>
      <div class="circle row1-center"></div>
      <div class="circle row1-right"></div>
    </div>
  </section>

  <section class="set">
    <h2>Number 7</h2>
    <div class="stack-seven" id="seven">
      <div class="circle top-left"></div>
      <div class="circle top-right"></div>
      <div class="circle mid-left"></div>
      <div class="circle mid-center"></div>
      <div class="circle mid-right"></div>
      <div class="circle bottom-left"></div>
      <div class="circle bottom-right"></div>
    </div>
  </section>

  <section class="set">
    <h2>Number 8</h2>
    <div class="stack-eight" id="eight">
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="gap"></div>
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="circle"></div>
    </div>
  </section>

  <section class="set">
    <h2>Number 9</h2>
    <div class="stack-nine" id="nine">
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="circle"></div>
    </div>
  </section>

  <section class="set">
    <h2>Number 10</h2>
    <div class="stack-ten" id="ten">
      <div class="circle row4"></div>
      <div class="circle row3-left"></div>
      <div class="circle row3-right"></div>
      <div class="circle row2-1"></div>
      <div class="circle row2-2"></div>
      <div class="circle row2-3"></div>
      <div class="circle row1-1"></div>
      <div class="circle row1-2"></div>
      <div class="circle row1-3"></div>
      <div class="circle row1-4"></div>
    </div>
  </section>
  </div> <!-- End practice mode -->

<script>
const COLOR_CLASSES = ["orange","yellow","green","blue","purple","brown","pink","sky","red-final"];
const NUMBER_WORDS = {
  en: ["zero","one","two","three","four","five","six","seven","eight","nine","ten"],
  zh: ["Èõ∂","‰∏Ä","‰∫å","‰∏â","Âõõ","‰∫î","ÂÖ≠","‰∏É","ÂÖ´","‰πù","ÂçÅ"],
  es: ["cero","uno","dos","tres","cuatro","cinco","seis","siete","ocho","nueve","diez"],
  fr: ["z√©ro","un","deux","trois","quatre","cinq","six","sept","huit","neuf","dix"],
  hi: ["‡§∂‡•Ç‡§®‡•ç‡§Ø","‡§è‡§ï","‡§¶‡•ã","‡§§‡•Ä‡§®","‡§ö‡§æ‡§∞","‡§™‡§æ‡§Ç‡§ö","‡§õ‡§π","‡§∏‡§æ‡§§","‡§Ü‡§†","‡§®‡•å","‡§¶‡§∏"],
  ko: ["ÏòÅ","Ïùº","Ïù¥","ÏÇº","ÏÇ¨","Ïò§","Ïú°","Ïπ†","Ìåî","Íµ¨","Ïã≠"],
  vi: ["kh√¥ng","m·ªôt","hai","ba","b·ªën","nƒÉm","s√°u","b·∫£y","t√°m","ch√≠n","m∆∞·ªùi"],
};
const LANGUAGE_HINTS = {
  en: "English",
  zh: "zh-CN",
  es: "es",
  fr: "fr",
  hi: "hi",
  ko: "ko-KR",
  vi: "vi-VN"
};
let currentLang = "en";
let preferredVoice = null;
let englishVoice = null;
const dualLang = new Set();
let lastSpokenCount = 0;
const SOUND_MODE = {
  OFF: "off",
  SOUND_ONLY: "sound"
};
let soundMode = SOUND_MODE.OFF;

const audioCtx = "AudioContext" in window ? new AudioContext() : ("webkitAudioContext" in window ? new webkitAudioContext() : null);

function pickVoice(langCode) {
  if (!("speechSynthesis" in window)) return null;
  const voices = window.speechSynthesis.getVoices();
  if (!voices.length) return null;

  const hint = LANGUAGE_HINTS[langCode] || langCode;
  const langGroup = voices.filter(v => v.lang && v.lang.startsWith(hint));
  
  if (langCode === "vi") {
    // PRIORITY 1: Google Vietnamese voices (exclude American-sounding)
    const googleVi = langGroup.filter(v => {
      const name = v.name.toLowerCase();
      const isGoogle = name.includes("google") && (name.includes("vietnamese") || name.includes("vi-") || name.includes("vi-vn"));
      const notAmerican = !name.includes("us") && !name.includes("en") && !name.includes("english") && !name.includes("united states");
      return isGoogle && notAmerican;
    });
    if (googleVi.length) {
      const femaleGoogle = googleVi.find(v => {
        const name = v.name.toLowerCase();
        return name.includes("female") || name.includes("f") || name.includes("n·ªØ") || name.includes("woman") || (v.gender && v.gender.toLowerCase() === "female");
      });
      if (femaleGoogle) return femaleGoogle;
      return googleVi[0];
    }
    
    // PRIORITY 2: Microsoft Vietnamese voices (exclude American-sounding)
    const msVi = langGroup.filter(v => {
      const name = v.name.toLowerCase();
      const isMs = name.includes("microsoft") && (name.includes("vietnamese") || name.includes("vi-") || name.includes("vi-vn"));
      const notAmerican = !name.includes("us") && !name.includes("en") && !name.includes("english") && !name.includes("united states");
      return isMs && notAmerican;
    });
    if (msVi.length) {
      const femaleMs = msVi.find(v => {
        const name = v.name.toLowerCase();
        return name.includes("female") || name.includes("f") || name.includes("n·ªØ") || name.includes("woman") || (v.gender && v.gender.toLowerCase() === "female");
      });
      if (femaleMs) return femaleMs;
      return msVi[0];
    }
    
    // PRIORITY 3: Any Vietnamese voice that doesn't sound American
    const nonAmericanVi = langGroup.filter(v => {
      const name = v.name.toLowerCase();
      return !name.includes("us") && !name.includes("en") && !name.includes("english") && !name.includes("united states");
    });
    if (nonAmericanVi.length) return nonAmericanVi[0];
    
    // Fallback: any Vietnamese voice
    if (langGroup.length) return langGroup[0];
  }
  
  if (langCode === "en") {
    // PRIORITY 1: Female natural/neural American voices
    const femaleNaturalEn = langGroup.filter(v => {
      const name = v.name.toLowerCase();
      const isFemale = name.includes("female") || name.includes("f") || name.includes("woman") || name.includes("zira") || name.includes("aria") || name.includes("susan") || name.includes("hazel") || name.includes("linda") || name.includes("karen") || name.includes("samantha") || (v.gender && v.gender.toLowerCase() === "female");
      const isNatural = name.includes("neural") || name.includes("natural") || name.includes("premium") || name.includes("enhanced") || name.includes("online") || name.includes("aria");
      const isAmerican = name.includes("us") || name.includes("united states") || name.includes("america");
      return isFemale && isNatural && isAmerican;
    });
    if (femaleNaturalEn.length) return femaleNaturalEn[0];
    
    // PRIORITY 2: High-quality female American voices
    const qualityFemaleEn = langGroup.filter(v => {
      const name = v.name.toLowerCase();
      return ((name.includes("aria") && name.includes("online")) || 
              (name.includes("google") && name.includes("female")) || 
              name.includes("zira") || name.includes("susan") || 
              name.includes("hazel") || name.includes("linda") || 
              name.includes("karen") || name.includes("samantha")) &&
             (name.includes("us") || name.includes("united states") || name.includes("america"));
    });
    if (qualityFemaleEn.length) return qualityFemaleEn[0];
    
    // PRIORITY 3: Any female American voice
    const femaleEn = langGroup.filter(v => {
      const name = v.name.toLowerCase();
      return (name.includes("female") || name.includes("f") || 
              name.includes("woman") || name.includes("zira") || 
              name.includes("aria") || name.includes("susan") || 
              name.includes("hazel") || name.includes("linda") ||
              name.includes("karen") || name.includes("samantha") ||
              (v.gender && v.gender.toLowerCase() === "female")) &&
             (name.includes("us") || name.includes("united states") || name.includes("america"));
    });
    if (femaleEn.length) return femaleEn[0];
    
    // Fallback: American English voices
    const americanEn = langGroup.filter(v => {
      const name = v.name.toLowerCase();
      return name.includes("us") || name.includes("united states") || name.includes("america");
    });
    if (americanEn.length) return americanEn[0];
    
    // Fallback: any English voice
    if (langGroup.length) return langGroup[0];
  }
  
  if (langCode === "zh") {
    // PRIORITY 1: Female Natural/Neural Chinese voices
    const femaleNaturalZh = langGroup.filter(v => {
      const name = v.name.toLowerCase();
      const isFemale = name.includes("female") || name.includes("f") || 
                      name.includes("woman") || name.includes("huihui") ||
                      name.includes("yaoyao") ||
                      (v.gender && v.gender.toLowerCase() === "female");
      const isNatural = name.includes("neural") || name.includes("natural") || 
                       name.includes("premium") || name.includes("enhanced");
      return isFemale && isNatural;
    });
    if (femaleNaturalZh.length) return femaleNaturalZh[0];
    
    // PRIORITY 2: Any Natural/Neural Chinese voices
    const naturalZh = langGroup.filter(v => {
      const name = v.name.toLowerCase();
      return name.includes("neural") || name.includes("natural") || 
             name.includes("premium") || name.includes("enhanced");
    });
    if (naturalZh.length) {
      const femaleNatural = naturalZh.find(v => {
        const name = v.name.toLowerCase();
        return name.includes("female") || name.includes("f") || 
               name.includes("woman") || name.includes("huihui") ||
               name.includes("yaoyao") ||
               (v.gender && v.gender.toLowerCase() === "female");
      });
      if (femaleNatural) return femaleNatural;
      return naturalZh[0];
    }
    
    // PRIORITY 3: Female Chinese voices
    const femaleZh = langGroup.filter(v => {
      const name = v.name.toLowerCase();
      return name.includes("female") || name.includes("f") || 
             name.includes("woman") || name.includes("huihui") ||
             name.includes("yaoyao") ||
             (v.gender && v.gender.toLowerCase() === "female");
    });
    if (femaleZh.length) return femaleZh[0];
    
    // PRIORITY 4: Google Chinese voices
    const googleZh = langGroup.filter(v => 
      v.name.toLowerCase().includes("google")
    );
    if (googleZh.length) return googleZh[0];
    
    // Fallback: any Chinese voice
    if (langGroup.length) return langGroup[0];
  }
  
  if (langCode === "fr") {
    // PRIORITY 1: Female Natural/Neural French voices
    const femaleNaturalFr = langGroup.filter(v => {
      const name = v.name.toLowerCase();
      const isFemale = name.includes("female") || name.includes("f") || 
                      name.includes("woman") || name.includes("denise") ||
                      name.includes("h√©l√®ne") ||
                      (v.gender && v.gender.toLowerCase() === "female");
      const isNatural = name.includes("neural") || name.includes("natural") || 
                       name.includes("premium") || name.includes("enhanced");
      return isFemale && isNatural;
    });
    if (femaleNaturalFr.length) return femaleNaturalFr[0];
    
    // PRIORITY 2: Any Natural/Neural French voices
    const naturalFr = langGroup.filter(v => {
      const name = v.name.toLowerCase();
      return name.includes("neural") || name.includes("natural") || 
             name.includes("premium") || name.includes("enhanced");
    });
    if (naturalFr.length) {
      const femaleNatural = naturalFr.find(v => {
        const name = v.name.toLowerCase();
        return name.includes("female") || name.includes("f") || 
               name.includes("woman") || name.includes("denise") ||
               name.includes("h√©l√®ne") ||
               (v.gender && v.gender.toLowerCase() === "female");
      });
      if (femaleNatural) return femaleNatural;
      return naturalFr[0];
    }
    
    // PRIORITY 3: Female French voices
    const femaleFr = langGroup.filter(v => {
      const name = v.name.toLowerCase();
      return name.includes("female") || name.includes("f") || 
             name.includes("woman") || name.includes("denise") ||
             name.includes("h√©l√®ne") ||
             (v.gender && v.gender.toLowerCase() === "female");
    });
    if (femaleFr.length) return femaleFr[0];
    
    // PRIORITY 4: Google French voices
    const googleFr = langGroup.filter(v => 
      v.name.toLowerCase().includes("google")
    );
    if (googleFr.length) return googleFr[0];
    
    // Fallback: any French voice
    if (langGroup.length) return langGroup[0];
  }
  
  // For other languages, use first available voice
  if (langGroup.length) return langGroup[0];
  
  // Fallback for English
  const fallbacks = [
    "Microsoft Aria Online (Natural) - English (United States)",
    "Google US English",
    "Google UK English Female",
    "Microsoft Zira Desktop - English (United States)"
  ];
  for (const name of fallbacks) {
    const voice = voices.find(v => v.name === name);
    if (voice) return voice;
  }
  return voices.find(v => v.lang && v.lang.startsWith("en")) || voices[0];
}

function initVoices(lang = currentLang) {
  preferredVoice = pickVoice(lang);
  englishVoice = pickVoice("en");
}

if ("speechSynthesis" in window) {
  window.speechSynthesis.onvoiceschanged = initVoices;
  initVoices();
}

function speakNumber(count) {
  const words = NUMBER_WORDS[currentLang] || NUMBER_WORDS.en;
  if (count < 0 || count >= words.length) return;
  if (!("speechSynthesis" in window)) return;
  lastSpokenCount = count;
  const shouldSpeakVoice = soundMode !== SOUND_MODE.SOUND_ONLY;
  const shouldPlayTone = soundMode !== SOUND_MODE.OFF;

  if (shouldSpeakVoice) {
    window.speechSynthesis.cancel();
    window.speechSynthesis.resume();
    const utterance = new SpeechSynthesisUtterance(words[count]);
    utterance.rate = 1.15;
    utterance.pitch = 1;
    if (preferredVoice) utterance.voice = preferredVoice;
    requestAnimationFrame(() => {
      window.speechSynthesis.speak(utterance);
      if (dualLang.has(currentLang) && currentLang !== "en" && englishVoice) {
        const englishWord = NUMBER_WORDS.en[count];
        const follow = new SpeechSynthesisUtterance(englishWord);
        follow.rate = 1.15;
        follow.pitch = 1;
        follow.voice = englishVoice;
        window.speechSynthesis.speak(follow);
      }
      if (shouldPlayTone) {
        playTone(count);
      }
    });
  } else if (shouldPlayTone) {
    playTone(count);
  }
}

function setupGroup(selector, palette) {
  const circles = Array.from(document.querySelectorAll(selector));

  function refreshColors() {
    circles.forEach(circle => circle.classList.remove(...COLOR_CLASSES));
    const active = circles.filter(circle => circle.classList.contains("red"));
    const color = palette[active.length];

    if (color) {
      active.forEach(circle => circle.classList.add(color));
    }
    return active.length;
  }

  circles.forEach(circle => {
    circle.addEventListener("click", () => {
      circle.classList.toggle("red");
      const count = refreshColors();
      speakNumber(count);
    });
  });
}

// NUMBER 1 ‚Äì single circle with voice feedback
const single = document.getElementById("one");
single.addEventListener("click", function() {
  this.classList.toggle("red");
  speakNumber(this.classList.contains("red") ? 1 : 0);
});

// Language + sound controls
const buttons = Array.from(document.querySelectorAll(".controls button[data-lang]"));
const dualButtons = Array.from(document.querySelectorAll(".controls button[data-dual]"));
const soundToggle = document.querySelector('.controls button[data-mode="sound"]');

const cycleSoundMode = () => {
  if (soundMode === SOUND_MODE.OFF) {
    soundMode = SOUND_MODE.SOUND_ONLY;
    soundToggle.textContent = "Sound Only";
  } else {
    soundMode = SOUND_MODE.OFF;
    soundToggle.textContent = "Sound";
  }
  soundToggle.classList.toggle("active", soundMode !== SOUND_MODE.OFF);
  if (soundMode !== SOUND_MODE.OFF && audioCtx && audioCtx.state === "suspended") {
    audioCtx.resume();
  }
};

soundToggle.addEventListener("click", cycleSoundMode);

function selectLanguage(lang, useDual, silent = false) {
  const isNewSelection = currentLang !== lang || useDual !== dualLang.has(lang);
  currentLang = lang;
  initVoices(lang);
  dualLang.clear();
  if (useDual && lang !== "en") {
    dualLang.add(lang);
  }
  
  // Turn off sound when language is clicked
  soundMode = SOUND_MODE.OFF;
  if (soundToggle) {
    soundToggle.textContent = "Sound";
    soundToggle.classList.remove("active");
  }
  
  buttons.forEach(btn => {
    const active = btn.dataset.lang === lang && !useDual;
    btn.classList.toggle("active", active);
  });

  dualButtons.forEach(btn => {
    const active = btn.dataset.dual === lang && useDual;
    btn.classList.toggle("active", active);
  });

  if (!silent && isNewSelection) {
    speakNumber(lastSpokenCount);
  }
}

const NOTE_FREQUENCIES = [0, 262, 294, 330, 349, 392, 440, 494, 523, 587, 659]; // C4..E5

function playTone(count) {
  if (!audioCtx || count <= 0 || count >= NOTE_FREQUENCIES.length) return;
  const frequency = NOTE_FREQUENCIES[count];
  const duration = 0.25;
  const now = audioCtx.currentTime;
  const oscillator = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  oscillator.type = "sine";
  oscillator.frequency.value = frequency;
  gain.gain.setValueAtTime(0.2, now);
  gain.gain.exponentialRampToValueAtTime(0.001, now + duration);
  oscillator.connect(gain);
  gain.connect(audioCtx.destination);
  oscillator.start(now);
  oscillator.stop(now + duration);
}

buttons.forEach(btn => {
  btn.addEventListener("click", () => {
    selectLanguage(btn.dataset.lang, false);
    if (gameMode) {
      updateInstructionsLanguage();
      const questionEl = document.getElementById('gameQuestion');
      if (questionEl) {
        questionEl.textContent = GAME_QUESTIONS[currentLang] || GAME_QUESTIONS.en;
      }
    }
  });
});

dualButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    selectLanguage(btn.dataset.dual, true);
    if (gameMode) {
      updateInstructionsLanguage();
      const questionEl = document.getElementById('gameQuestion');
      if (questionEl) {
        questionEl.textContent = GAME_QUESTIONS[currentLang] || GAME_QUESTIONS.en;
      }
    }
  });
});

selectLanguage("en", false, true);

setupGroup("#two .circle",   {2: "orange"});
setupGroup("#three .circle", {2: "orange", 3: "yellow"});
setupGroup("#four .circle",  {2: "orange", 3: "yellow", 4: "green"});
setupGroup("#five .circle",  {2: "orange", 3: "yellow", 4: "green", 5: "blue"});
setupGroup("#six .circle",   {2: "orange", 3: "yellow", 4: "green", 5: "blue", 6: "purple"});
setupGroup("#seven .circle", {2: "orange", 3: "yellow", 4: "green", 5: "blue", 6: "purple", 7: "brown"});
setupGroup("#eight .circle", {2: "orange", 3: "yellow", 4: "green", 5: "blue", 6: "purple", 7: "brown", 8: "pink"});
setupGroup("#nine .circle",  {2: "orange", 3: "yellow", 4: "green", 5: "blue", 6: "purple", 7: "brown", 8: "pink", 9: "sky"});
setupGroup("#ten .circle",   {2: "orange", 3: "yellow", 4: "green", 5: "blue", 6: "purple", 7: "brown", 8: "pink", 9: "sky", 10: "red-final"});

// ========== GAME MODE ==========
const GAME_QUESTIONS = {
  en: "Which one is bigger?",
  vi: "C√°i n√†o l·ªõn h∆°n?",
  zh: "Âì™‰∏™Êõ¥Â§ßÔºü",
  ko: "Ïñ¥Îäê Í≤ÉÏù¥ Îçî ÌÅ∞Í∞ÄÏöî?",
  es: "¬øCu√°l es m√°s grande?",
  fr: "Lequel est plus grand?",
  hi: "‡§ï‡•å‡§® ‡§∏‡§æ ‡§¨‡§°‡§º‡§æ ‡§π‡•à?"
};

let gameMode = false;
let allQuestions = [];
let currentQuestionIndex = 0;
let currentGroupStart = 0;
let scoreCorrect = 0;
let scoreTotal = 0;
let answeredInGroup = 0;
let autoAdvanceTimeout = null;

function getColorClassForNumber(num) {
  const colorMap = {
    1: 'red',
    2: 'orange',
    3: 'yellow',
    4: 'green',
    5: 'blue',
    6: 'purple',
    7: 'brown',
    8: 'pink',
    9: 'sky',
    10: 'red-final'
  };
  return colorMap[num] || '';
}

function createNumberGroup(num) {
  const container = document.createElement('div');
  container.className = 'game-option';
  container.dataset.number = num;
  const colorClass = getColorClassForNumber(num);
  
  // Create the appropriate structure based on number
  if (num === 1) {
    const circle = document.createElement('div');
    circle.className = `circle ${colorClass}`;
    container.appendChild(circle);
  } else if (num === 2) {
    container.className += ' pair';
    for (let i = 0; i < 2; i++) {
      const circle = document.createElement('div');
      circle.className = `circle ${colorClass}`;
      container.appendChild(circle);
    }
  } else if (num === 3) {
    container.className += ' stack-three';
    const positions = ['top', 'bottom-left', 'bottom-right'];
    positions.forEach(pos => {
      const circle = document.createElement('div');
      circle.className = `circle ${pos} ${colorClass}`;
      container.appendChild(circle);
    });
  } else if (num === 4) {
    container.className += ' stack-four';
    const positions = ['top-left', 'top-right', 'bottom-left', 'bottom-right'];
    positions.forEach(pos => {
      const circle = document.createElement('div');
      circle.className = `circle ${pos} ${colorClass}`;
      container.appendChild(circle);
    });
  } else if (num === 5) {
    container.className += ' stack-five';
    const positions = ['row2-left', 'row2-right', 'row1-left', 'row1-center', 'row1-right'];
    positions.forEach(pos => {
      const circle = document.createElement('div');
      circle.className = `circle ${pos} ${colorClass}`;
      container.appendChild(circle);
    });
  } else if (num === 6) {
    container.className += ' stack-six';
    const positions = ['row3', 'row2-left', 'row2-right', 'row1-left', 'row1-center', 'row1-right'];
    positions.forEach(pos => {
      const circle = document.createElement('div');
      circle.className = `circle ${pos} ${colorClass}`;
      container.appendChild(circle);
    });
  } else if (num === 7) {
    container.className += ' stack-seven';
    const positions = ['top-left', 'top-right', 'mid-left', 'mid-center', 'mid-right', 'bottom-left', 'bottom-right'];
    positions.forEach(pos => {
      const circle = document.createElement('div');
      circle.className = `circle ${pos} ${colorClass}`;
      container.appendChild(circle);
    });
  } else if (num === 8) {
    container.className += ' stack-eight';
    // Create 3x3 grid with middle missing (hollow square)
    for (let row = 0; row < 3; row++) {
      for (let col = 0; col < 3; col++) {
        if (row === 1 && col === 1) {
          // Middle position - add gap
          const gap = document.createElement('div');
          gap.className = 'gap';
          container.appendChild(gap);
        } else {
          const circle = document.createElement('div');
          circle.className = `circle ${colorClass}`;
          container.appendChild(circle);
        }
      }
    }
  } else if (num === 9) {
    container.className += ' stack-nine';
    // Create full 3x3 grid with all touching
    for (let i = 0; i < 9; i++) {
      const circle = document.createElement('div');
      circle.className = `circle ${colorClass}`;
      container.appendChild(circle);
    }
  } else if (num === 10) {
    container.className += ' stack-ten';
    const positions = ['row4', 'row3-left', 'row3-right', 'row2-1', 'row2-2', 'row2-3', 'row1-1', 'row1-2', 'row1-3', 'row1-4'];
    positions.forEach(pos => {
      const circle = document.createElement('div');
      circle.className = `circle ${pos} ${colorClass}`;
      container.appendChild(circle);
    });
    // Add triangle outline using SVG polygon
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.className = 'triangle-svg';
    svg.setAttribute('viewBox', '-10 -5 120 115'); // Extended viewBox to accommodate larger triangle
    svg.setAttribute('preserveAspectRatio', 'none');
    svg.setAttribute('overflow', 'visible');
    
    // Triangle points - made bigger (coordinates in viewBox space):
    // Top point: higher up to make triangle bigger
    //   - X: 35 (37.5% of 100, adjusted for viewBox)
    //   - Y: 4 (8% of 100, adjusted for viewBox, moved up from 14% to make triangle bigger)
    // Bottom left: extend beyond left edge
    //   - X: -6 (extend beyond left edge)
    //   - Y: 116 (extend below bottom)
    // Bottom right: extend beyond right edge
    //   - X: 116 (extend beyond right edge)
    //   - Y: 116 (extend below bottom)
    const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
    polygon.setAttribute('points', '35,4 -6,116 116,116');
    polygon.setAttribute('fill', 'none');
    polygon.setAttribute('stroke', '#fff');
    polygon.setAttribute('stroke-width', '4');
    polygon.setAttribute('stroke-linejoin', 'round');
    polygon.setAttribute('stroke-linecap', 'round');
    svg.appendChild(polygon);
    
    container.appendChild(svg);
  }
  
  return container;
}

// Generate all 45 question pairs (10 choose 2)
function generateAllQuestions() {
  const questions = [];
  for (let i = 1; i <= 10; i++) {
    for (let j = i + 1; j <= 10; j++) {
      // Randomize left/right position
      if (Math.random() > 0.5) {
        questions.push({ num1: j, num2: i, correct: j, id: `${j}-${i}` });
      } else {
        questions.push({ num1: i, num2: j, correct: j, id: `${i}-${j}` });
      }
    }
  }
  // Shuffle questions
  for (let i = questions.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [questions[i], questions[j]] = [questions[j], questions[i]];
  }
  return questions;
}

// Play success sound
function playSuccessSound() {
  if (!audioCtx) return;
  const now = audioCtx.currentTime;
  const oscillator = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  oscillator.type = "sine";
  oscillator.frequency.value = 523; // C5
  gain.gain.setValueAtTime(0.3, now);
  gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
  oscillator.connect(gain);
  gain.connect(audioCtx.destination);
  oscillator.start(now);
  oscillator.stop(now + 0.3);
}

function displayQuestionGroup() {
  const groupEl = document.getElementById('gameQuestionsGroup');
  const questionEl = document.getElementById('gameQuestion');
  const groupCompleteEl = document.getElementById('groupComplete');
  
  if (!groupEl) return;
  
  if (questionEl) {
    questionEl.textContent = GAME_QUESTIONS[currentLang] || GAME_QUESTIONS.en;
  }
  
  groupEl.innerHTML = '';
  if (groupCompleteEl) {
    groupCompleteEl.classList.remove('show');
  }
  
  answeredInGroup = 0;
  const questionsToShow = allQuestions.slice(currentGroupStart, currentGroupStart + 10);
  
  questionsToShow.forEach((q, index) => {
    const row = document.createElement('div');
    row.className = 'game-question-row';
    row.dataset.questionIndex = currentGroupStart + index;
    
    const option1 = createNumberGroup(q.num1);
    const option2 = createNumberGroup(q.num2);
    const symbol = document.createElement('div');
    symbol.className = 'game-comparison-symbol';
    symbol.id = `symbol-${currentGroupStart + index}`;
    const feedback = document.createElement('div');
    feedback.className = 'game-feedback';
    feedback.id = `feedback-${currentGroupStart + index}`;
    
    option1.addEventListener('click', () => handleAnswer(q.num1, q, currentGroupStart + index));
    option2.addEventListener('click', () => handleAnswer(q.num2, q, currentGroupStart + index));
    
    row.appendChild(option1);
    row.appendChild(symbol);
    row.appendChild(option2);
    row.appendChild(feedback);
    groupEl.appendChild(row);
  });
  
  updateScore();
}

const ENCOURAGING_MESSAGES = [
  "Terrific!", "Good job!", "Way to go!", "That's right!", "Nice!", "Excellent!", 
  "Fabulous!", "Perfect!", "Awesome!", "Great!", "Super!", "Wonderful!", 
  "Fantastic!", "Brilliant!", "Amazing!", "Outstanding!", "Marvelous!", 
  "Splendid!", "Bravo!", "Well done!", "You got it!", "Yes!", "Right on!",
  "Perfect!", "Nice work!", "Keep it up!", "You're doing great!", "That's it!"
];

let usedMessages = [];

function getRandomEncouragement() {
  if (usedMessages.length >= ENCOURAGING_MESSAGES.length) {
    usedMessages = []; // Reset if we've used them all
  }
  let available = ENCOURAGING_MESSAGES.filter(m => !usedMessages.includes(m));
  if (available.length === 0) {
    usedMessages = [];
    available = ENCOURAGING_MESSAGES;
  }
  const message = available[Math.floor(Math.random() * available.length)];
  usedMessages.push(message);
  return message;
}

// Play wrong answer sound
function playWrongSound() {
  if (!audioCtx) return;
  const now = audioCtx.currentTime;
  const oscillator = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  oscillator.type = "sawtooth";
  oscillator.frequency.value = 200; // Lower, less pleasant sound
  gain.gain.setValueAtTime(0.2, now);
  gain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
  oscillator.connect(gain);
  gain.connect(audioCtx.destination);
  oscillator.start(now);
  oscillator.stop(now + 0.2);
}

function handleAnswer(answer, question, rowIndex) {
  const row = document.querySelector(`[data-question-index="${rowIndex}"]`);
  if (!row || row.dataset.answered === 'true') return; // Already answered correctly
  
  const isCorrect = answer === question.correct;
  
  if (isCorrect) {
    row.dataset.answered = 'true';
    scoreTotal++;
    scoreCorrect++;
    playSuccessSound();
    
    // Show comparison symbol
    const symbolEl = document.getElementById(`symbol-${rowIndex}`);
    if (symbolEl) {
      if (question.num1 > question.num2) {
        symbolEl.textContent = '>';
      } else {
        symbolEl.textContent = '<';
      }
      symbolEl.classList.add('show');
    }
    
    // Show varied encouraging feedback
    const feedbackEl = document.getElementById(`feedback-${rowIndex}`);
    if (feedbackEl) {
      const message = getRandomEncouragement();
      feedbackEl.textContent = message + " ‚úì";
      feedbackEl.classList.add('show', 'correct');
      
      // Speak the encouragement - softer, more pleasing voice
      if ("speechSynthesis" in window) {
        const utterance = new SpeechSynthesisUtterance(message);
        utterance.rate = 0.9; // Slower, softer
        utterance.pitch = 0.95; // Lower pitch, less forceful
        utterance.volume = 0.8; // Slightly quieter
        // Try to find a more pleasant voice
        const voices = window.speechSynthesis.getVoices();
        const pleasantVoices = voices.filter(v => 
          (v.name.includes('Female') || v.name.includes('Woman') || v.name.includes('Samantha') || 
           v.name.includes('Karen') || v.name.includes('Victoria') || v.name.includes('Zira')) &&
          v.lang.startsWith('en')
        );
        if (pleasantVoices.length > 0) {
          utterance.voice = pleasantVoices[0];
        } else if (preferredVoice) {
          utterance.voice = preferredVoice;
        }
        window.speechSynthesis.speak(utterance);
      }
    }
    
    // Mark options
    const options = row.querySelectorAll('.game-option');
    options.forEach(opt => {
      const num = parseInt(opt.dataset.number);
      opt.classList.add('selected');
      if (num === question.correct) {
        opt.classList.add('correct');
      }
    });
    
    answeredInGroup++;
    updateScore();
    
    // Auto-advance to next group after 10 questions
    if (answeredInGroup >= 10) {
      setTimeout(() => {
        const groupCompleteEl = document.getElementById('groupComplete');
        if (groupCompleteEl) {
          groupCompleteEl.classList.add('show');
        }
        setTimeout(() => {
          const groupEl = document.getElementById('gameQuestionsGroup');
          if (groupEl) {
            // Slide out to left
            groupEl.classList.add('slide-out-left');
            setTimeout(() => {
              currentGroupStart += 10;
              if (currentGroupStart < allQuestions.length) {
                displayQuestionGroup();
                // Slide in from right
                setTimeout(() => {
                  groupEl.classList.remove('slide-out-left');
                  groupEl.classList.add('slide-in-right');
                  setTimeout(() => {
                    groupEl.classList.remove('slide-in-right');
                  }, 500);
                }, 50);
              } else {
                // Game complete
                groupEl.classList.remove('slide-out-left');
                groupEl.innerHTML = '<div style="text-align:center;font-size:2em;margin:50px 0;">Game Complete! üéâ</div>';
              }
            }, 500);
          }
        }, 2000);
      }, 1000);
    }
  } else {
    // Wrong answer - allow retry
    playWrongSound();
    
    const feedbackEl = document.getElementById(`feedback-${rowIndex}`);
    if (feedbackEl) {
      feedbackEl.textContent = "Try again!";
      feedbackEl.classList.add('show', 'incorrect');
      
      // Speak "try again" - softer voice
      if ("speechSynthesis" in window) {
        const utterance = new SpeechSynthesisUtterance("Try again");
        utterance.rate = 0.9;
        utterance.pitch = 0.95;
        utterance.volume = 0.8;
        const voices = window.speechSynthesis.getVoices();
        const pleasantVoices = voices.filter(v => 
          (v.name.includes('Female') || v.name.includes('Woman') || v.name.includes('Samantha') || 
           v.name.includes('Karen') || v.name.includes('Victoria') || v.name.includes('Zira')) &&
          v.lang.startsWith('en')
        );
        if (pleasantVoices.length > 0) {
          utterance.voice = pleasantVoices[0];
        } else if (preferredVoice) {
          utterance.voice = preferredVoice;
        }
        window.speechSynthesis.speak(utterance);
      }
    }
    
    // Mark wrong option
    const options = row.querySelectorAll('.game-option');
    options.forEach(opt => {
      const num = parseInt(opt.dataset.number);
      if (num === answer) {
        opt.classList.add('incorrect');
        // Clear after a moment to allow retry
        setTimeout(() => {
          opt.classList.remove('incorrect');
          if (feedbackEl) {
            feedbackEl.textContent = '';
            feedbackEl.classList.remove('show', 'incorrect');
          }
        }, 1500);
      }
    });
  }
}

function updateScore() {
  const scoreCorrectEl = document.getElementById('scoreCorrect');
  const scoreTotalEl = document.getElementById('scoreTotal');
  
  if (scoreCorrectEl) {
    scoreCorrectEl.innerHTML = createScoreWithDots(scoreCorrect);
  }
  if (scoreTotalEl) {
    scoreTotalEl.innerHTML = createScoreWithDots(scoreTotal);
  }
}

function createScoreWithDots(num) {
  const colorMap = {
    0: '#222', 1: '#ff0000', 2: '#ff6200', 3: '#ffe600', 4: '#00a12c',
    5: '#0030ff', 6: '#8b3dff', 7: '#7a3b00', 8: '#ff3fa6', 9: '#38c7ff'
  };
  
  // Convert number to string to get each digit
  const numStr = num.toString();
  let result = '';
  
  // Process each digit separately
  for (let i = 0; i < numStr.length; i++) {
    const digit = parseInt(numStr[i]);
    
    if (digit === 0) {
      // Show empty circle for 0
      const dotRep = createDotRepresentation(0, '#222');
      result += `<div style="display:inline-flex;flex-direction:column;align-items:center;margin:0 3px;">
        ${dotRep}
        <span style="color:#222;font-weight:bold;font-size:1.2em;">0</span>
        <span style="font-size:0.5em;color:#888;">0</span>
      </div>`;
    } else if (digit === 1 && i < numStr.length - 1 && numStr[i + 1] === '0') {
      // Handle "10" - show triangle
      const triangleRep = createDotRepresentation(10, '#fff');
      result += `<div style="display:inline-flex;flex-direction:column;align-items:center;margin:0 3px;">
        ${triangleRep}
        <span style="color:#fff;font-weight:bold;font-size:1.2em;">10</span>
        <span style="font-size:0.5em;color:#888;">10</span>
      </div>`;
      i++; // Skip the next digit (0)
    } else {
      // Show dots for this digit
      const dotRep = createDotRepresentation(digit, colorMap[digit]);
      result += `<div style="display:inline-flex;flex-direction:column;align-items:center;margin:0 3px;">
        ${dotRep}
        <span style="color:${colorMap[digit]};font-weight:bold;font-size:1.2em;">${digit}</span>
        <span style="font-size:0.5em;color:#888;">${digit}</span>
      </div>`;
    }
  }
  
  return result;
}

function createDotRepresentation(num, color) {
  if (num === 0) {
    return '<div style="width:12px;height:12px;border:1px solid #fff;border-radius:50%;background:transparent;margin:2px 0;"></div>';
  }
  if (num === 10) {
    // Triangle for 10 - white border outline
    const size = 20;
    return `<div style="position:relative;width:${size}px;height:${size * 0.866}px;margin:2px auto;">
      <div style="position:absolute;top:0;left:50%;transform:translateX(-50%);width:0;height:0;border-left:${size * 0.5 + 2}px solid transparent;border-right:${size * 0.5 + 2}px solid transparent;border-bottom:${size * 0.866 + 2}px solid #fff;border-bottom-width:2px;"></div>
      <div style="position:absolute;top:1px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:${size * 0.5}px solid transparent;border-right:${size * 0.5}px solid transparent;border-bottom:${size * 0.866}px solid transparent;"></div>
    </div>`;
  }
  // For numbers 1-9, show the actual number of dots
  let dots = '';
  const dotSize = 6;
  const dotSpacing = 2;
  
  if (num === 1) {
    dots = `<div style="width:${dotSize}px;height:${dotSize}px;border-radius:50%;background:${color};border:1px solid #fff;margin:2px auto;"></div>`;
  } else if (num === 2) {
    dots = `<div style="display:flex;gap:${dotSpacing}px;justify-content:center;">
      <div style="width:${dotSize}px;height:${dotSize}px;border-radius:50%;background:${color};border:1px solid #fff;"></div>
      <div style="width:${dotSize}px;height:${dotSize}px;border-radius:50%;background:${color};border:1px solid #fff;"></div>
    </div>`;
  } else if (num === 3) {
    dots = `<div style="display:flex;flex-direction:column;align-items:center;gap:${dotSpacing}px;">
      <div style="width:${dotSize}px;height:${dotSize}px;border-radius:50%;background:${color};border:1px solid #fff;"></div>
      <div style="display:flex;gap:${dotSpacing}px;">
        <div style="width:${dotSize}px;height:${dotSize}px;border-radius:50%;background:${color};border:1px solid #fff;"></div>
        <div style="width:${dotSize}px;height:${dotSize}px;border-radius:50%;background:${color};border:1px solid #fff;"></div>
      </div>
    </div>`;
  } else {
    // For 4-9, show simplified representation (small dots in a row)
    dots = `<div style="display:flex;gap:${dotSpacing}px;justify-content:center;flex-wrap:wrap;max-width:${dotSize * 3 + dotSpacing * 2}px;">
      ${Array(num).fill(0).map(() => `<div style="width:${dotSize}px;height:${dotSize}px;border-radius:50%;background:${color};border:1px solid #fff;"></div>`).join('')}
    </div>`;
  }
  
  return dots;
}

function updateInstructionsLanguage() {
  const instructions = document.querySelectorAll('.lang-instructions');
  instructions.forEach(inst => {
    inst.classList.toggle('active', inst.dataset.lang === currentLang);
  });
}

// Game mode toggle
const gameToggle = document.getElementById('gameToggle');
if (gameToggle) {
  gameToggle.addEventListener('click', () => {
    gameMode = !gameMode;
    const practiceMode = document.getElementById('practiceMode');
    const gameArea = document.getElementById('gameArea');
    const instructions = document.getElementById('instructions');
    
    if (gameMode) {
      if (practiceMode) practiceMode.classList.add('hide');
      if (gameArea) gameArea.classList.add('show');
      if (instructions) instructions.classList.add('show');
      gameToggle.textContent = '‚Üê Back to Practice';
      
      // Initialize game
      allQuestions = generateAllQuestions();
      currentQuestionIndex = 0;
      currentGroupStart = 0;
      scoreCorrect = 0;
      scoreTotal = 0;
      answeredInGroup = 0;
      usedMessages = []; // Reset encouraging messages
      
      displayQuestionGroup();
      updateInstructionsLanguage();
    } else {
      if (practiceMode) practiceMode.classList.remove('hide');
      if (gameArea) gameArea.classList.remove('show');
      if (instructions) instructions.classList.remove('show');
      gameToggle.textContent = 'üéÆ Play Game';
      
      if (autoAdvanceTimeout) {
        clearTimeout(autoAdvanceTimeout);
        autoAdvanceTimeout = null;
      }
    }
  });
}

const backToPracticeBtn = document.getElementById('backToPractice');
if (backToPracticeBtn) {
  backToPracticeBtn.addEventListener('click', () => {
    gameMode = false;
    const practiceMode = document.getElementById('practiceMode');
    const gameArea = document.getElementById('gameArea');
    const instructions = document.getElementById('instructions');
    if (practiceMode) practiceMode.classList.remove('hide');
    if (gameArea) gameArea.classList.remove('show');
    if (instructions) instructions.classList.remove('show');
    if (gameToggle) gameToggle.textContent = 'üéÆ Play Game';
  });
}
</script>

<!-- html2pdf.js library for PDF generation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
async function downloadPDF() {
  // Show loading message
  const originalText = event.target.textContent;
  event.target.textContent = "‚è≥ Generating PDF...";
  event.target.disabled = true;
  
  try {
    // Get the main content area (exclude navigation)
    const element = document.body;
    const opt = {
      margin: [10, 10, 10, 10],
      filename: 'math-bigger-smaller.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { 
        scale: 2,
        useCORS: true,
        backgroundColor: '#ffffff',
        ignoreElements: (el) => {
          // Exclude navigation, controls, and game elements from PDF
          return el.classList.contains('game-navigation') || 
                 el.classList.contains('controls') ||
                 el.classList.contains('game-mode-toggle') ||
                 el.id === 'gameArea' ||
                 el.id === 'instructions';
        },
        onclone: (clonedDoc) => {
          // Change text color to black for PDF
          clonedDoc.body.style.backgroundColor = '#ffffff';
          clonedDoc.body.style.color = '#000000';
          const allElements = clonedDoc.querySelectorAll('*');
          allElements.forEach(el => {
            const style = window.getComputedStyle(el);
            if (style.color === 'rgb(255, 255, 255)' || style.color === 'white') {
              el.style.color = '#000000';
            }
          });
        }
      },
      jsPDF: { 
        unit: 'mm', 
        format: 'a4', 
        orientation: 'portrait' 
      }
    };
    
    // Generate and download PDF
    await html2pdf().set(opt).from(element).save();
    
    // Restore button
    event.target.textContent = originalText;
    event.target.disabled = false;
  } catch (error) {
    console.error('Error generating PDF:', error);
    alert('Error generating PDF. Please try again.');
    event.target.textContent = originalText;
    event.target.disabled = false;
  }
}
</script>

</body>
</html>