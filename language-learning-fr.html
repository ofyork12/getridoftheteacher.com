<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Language Learning - French Vocabulary</title>
  <style>
    :root {
      --primary-color: #fff;
      --bg-color: #000;
      --card-bg: #111;
      --accent-color: #4a9eff;
      --hover-color: #333;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg-color);
      color: var(--primary-color);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      padding: 20px 12px 40px;
      overflow-y: auto;
      -webkit-tap-highlight-color: transparent;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .navigation {
      display: flex;
      gap: 20px;
      margin: 20px 0 30px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .nav-button {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      background: transparent;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }
    .nav-button:hover {
      background: var(--primary-color);
      color: var(--bg-color);
    }
    .game-button {
      display: block;
      margin: 20px auto 30px;
      padding: 18px 40px;
      font-size: 20px;
      font-weight: bold;
      background: var(--accent-color);
      color: var(--bg-color);
      border: 3px solid var(--accent-color);
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 4px 12px rgba(74, 158, 255, 0.4);
    }
    .game-button:hover {
      background: #6bb0ff;
      border-color: #6bb0ff;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(74, 158, 255, 0.5);
    }
    .game-button:active {
      transform: translateY(0);
    }
    h1 {
      text-align: center;
      font-size: clamp(28px, 5vw, 42px);
      margin: 0 0 30px;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 30px;
      justify-content: center;
      align-items: center;
    }
    .lang-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .controls button {
      padding: 10px 20px;
      border: 2px solid var(--primary-color);
      border-radius: 999px;
      background: transparent;
      color: var(--primary-color);
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 120px;
    }
    .controls button:hover {
      background: var(--hover-color);
    }
    .controls button.active {
      background: var(--primary-color);
      color: var(--bg-color);
    }
    .search-box {
      width: 100%;
      max-width: 400px;
      padding: 12px 20px;
      border: 2px solid var(--primary-color);
      border-radius: 999px;
      background: var(--card-bg);
      color: var(--primary-color);
      font-size: 16px;
      margin: 0 auto 30px;
      display: block;
    }
    .search-box:focus {
      outline: none;
      border-color: var(--accent-color);
    }
    .vocab-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .vocab-card {
      background: var(--card-bg);
      border: 2px solid var(--primary-color);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .vocab-card:hover {
      border-color: var(--accent-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(74, 158, 255, 0.3);
    }
    .vocab-word {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 12px;
      color: var(--accent-color);
    }
    .vocab-translations {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .translation-row {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 8px 0;
      border-bottom: 1px solid #333;
    }
    .translation-row:last-child {
      border-bottom: none;
    }
    .lang-label {
      font-weight: bold;
      min-width: 80px;
      font-size: 14px;
      text-transform: uppercase;
      opacity: 0.8;
    }
    .lang-content {
      flex: 1;
      font-size: 16px;
    }
    .pinyin {
      font-size: 14px;
      opacity: 0.7;
      font-style: italic;
      margin-top: 4px;
    }
    .play-button {
      background: var(--accent-color);
      border: none;
      color: var(--bg-color);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      flex-shrink: 0;
    }
    .play-button:hover {
      background: #6bb0ff;
      transform: scale(1.1);
    }
    .play-button:active {
      transform: scale(0.95);
    }
    .no-results {
      text-align: center;
      padding: 40px;
      font-size: 18px;
      opacity: 0.6;
    }
    @media (max-width: 768px) {
      .vocab-grid {
        grid-template-columns: 1fr;
      }
      .controls button {
        min-width: 100px;
        font-size: 14px;
        padding: 8px 16px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="navigation">
      <a href="index.html" class="nav-button">Home</a>
      <a href="language-learning-fr.html" class="nav-button">French Vocabulary</a>
      <a href="language-learning-game-fr.html" class="nav-button">French â†’ English Game</a>
      <a href="language-learning-game-en-fr.html" class="nav-button">English â†’ French Game</a>
    </div>
    
    <h1>Language Learning - French Vocabulary</h1>
    
    <a href="language-learning-game-fr.html" class="game-button">ðŸŽ® Play French Game</a>
    
    <div class="controls" role="group" aria-label="Language selector">
      <div class="lang-group">
        <button data-lang="all" class="active">All Languages</button>
      </div>
      <div class="lang-group">
        <button data-lang="fr">French</button>
      </div>
      <div class="lang-group">
        <button data-lang="en">English</button>
      </div>
      <div class="lang-group">
        <button data-lang="vi">Vietnamese</button>
      </div>
      <div class="lang-group">
        <button data-lang="zh">Mandarin</button>
      </div>
    </div>

    <input type="text" class="search-box" id="searchBox" placeholder="Search vocabulary...">

    <div class="vocab-grid" id="vocabGrid"></div>
    <div class="no-results" id="noResults" style="display: none;">No vocabulary found matching your search.</div>
  </div>

<script>
const VOCABULARY = [
  {
    vi: "cuá»‘i cÃ¹ng",
    en: "finally, last, final",
    zh: "æœ€åŽ",
    zhPinyin: "zuÃ¬ hÃ²u",
    fr: "finalement, enfin"
  },
  {
    vi: "Ä‘áº§u tiÃªn",
    en: "first in order",
    zh: "ç¬¬ä¸€",
    zhPinyin: "dÃ¬ yÄ«",
    fr: "premier / premiÃ¨re"
  },
  {
    vi: "thá»©",
    en: "thing, things, ordinal marker",
    zh: "ä¸œè¥¿ / ç¬¬",
    zhPinyin: "dÅng xi / dÃ¬",
    fr: "chose ; marqueur ordinal"
  },
  {
    vi: "láº§n",
    en: "time, times, turns",
    zh: "æ¬¡",
    zhPinyin: "cÃ¬",
    fr: "fois"
  },
  {
    vi: "vÃ o",
    en: "enter, to go into",
    zh: "è¿›å…¥",
    zhPinyin: "jÃ¬n rÃ¹",
    fr: "entrer"
  },
  {
    vi: "dang",
    en: "is / am / are action in progress",
    zh: "æ­£åœ¨",
    zhPinyin: "zhÃ¨ng zÃ i",
    fr: "Ãªtre en train de"
  },
  {
    vi: "lÃºc nÃ y",
    en: "now, this moment, right now",
    zh: "æ­¤åˆ»",
    zhPinyin: "cÇ kÃ¨",
    fr: "en ce moment"
  },
  {
    vi: "bÃ¢y giá»",
    en: "now, at the moment",
    zh: "çŽ°åœ¨",
    zhPinyin: "xiÃ n zÃ i",
    fr: "maintenant"
  },
  {
    vi: "hiá»‡n táº¡i",
    en: "currently, at present",
    zh: "ç›®å‰ / çŽ°åœ¨",
    zhPinyin: "mÃ¹ qiÃ¡n / xiÃ n zÃ i",
    fr: "actuellement"
  },
  {
    vi: "nÃªn",
    en: "so, therefore, ought to",
    zh: "æ‰€ä»¥ / åº”è¯¥",
    zhPinyin: "suÇ’ yÇ / yÄ«ng gÄi",
    fr: "donc, devoir"
  },
  {
    vi: "trÆ°á»›c",
    en: "before, ago, in front of",
    zh: "ä»¥å‰ / å‰é¢",
    zhPinyin: "yÇ qiÃ¡n / qiÃ¡n miÃ n",
    fr: "avant, devant"
  },
  {
    vi: "nhÆ°ng",
    en: "but, however",
    zh: "ä½†æ˜¯",
    zhPinyin: "dÃ n shÃ¬",
    fr: "mais"
  },
  {
    vi: "mÃ  cÃ²n",
    en: "not only, but also",
    zh: "è€Œä¸”",
    zhPinyin: "Ã©r qiÄ›",
    fr: "non seulementâ€¦ mais aussi"
  },
  {
    vi: "Ä‘á»u",
    en: "all, both",
    zh: "éƒ½",
    zhPinyin: "dÅu",
    fr: "tous, toutes"
  },
  {
    vi: "cáº£",
    en: "all, whole",
    zh: "å…¨éƒ¨",
    zhPinyin: "quÃ¡n bÃ¹",
    fr: "tout, toute"
  },
  {
    vi: "tuy",
    en: "although, despite",
    zh: "è™½ç„¶",
    zhPinyin: "suÄ« rÃ¡n",
    fr: "bien que"
  },
  {
    vi: "Náº¿u",
    en: "If, conditional",
    zh: "å¦‚æžœ",
    zhPinyin: "rÃº guÇ’",
    fr: "si"
  },
  {
    vi: "trong khi",
    en: "While, at the same time",
    zh: "å½“â€¦çš„æ—¶å€™",
    zhPinyin: "dÄng â€¦ de shÃ­ hÃ²u",
    fr: "pendant que"
  },
  {
    vi: "thÃ¬",
    en: "Then, sentence marker",
    zh: "å°±",
    zhPinyin: "jiÃ¹",
    fr: "alors"
  },
  {
    vi: "khi nÃ o",
    en: "when, at what time",
    zh: "ä»€ä¹ˆæ—¶å€™",
    zhPinyin: "shÃ©n me shÃ­ hÃ²u",
    fr: "quand"
  },
  {
    vi: "hoáº·c",
    en: "or either â€¦ or",
    zh: "æˆ–è€…",
    zhPinyin: "huÃ² zhÄ›",
    fr: "ou"
  },
  {
    vi: "bá»Ÿi vÃ¬",
    en: "because, reason",
    zh: "å› ä¸º",
    zhPinyin: "yÄ«n wÃ¨i",
    fr: "parce que"
  },
  {
    vi: "tá»•ng cá»™ng",
    en: "total, in total",
    zh: "æ€»å…±",
    zhPinyin: "zÇ’ng gÃ²ng",
    fr: "au total"
  },
  {
    vi: "sá»‘",
    en: "number, digit",
    zh: "æ•°å­—",
    zhPinyin: "shÃ¹ zÃ¬",
    fr: "nombre"
  },
  {
    vi: "ná»­a",
    en: "half, one half",
    zh: "ä¸€åŠ",
    zhPinyin: "yÃ­ bÃ n",
    fr: "moitiÃ©"
  },
  {
    vi: "Ä‘á»§",
    en: "enough, sufficient",
    zh: "è¶³å¤Ÿ",
    zhPinyin: "zÃº gÃ²u",
    fr: "assez"
  },
  {
    vi: "tá»·",
    en: "one billion",
    zh: "åäº¿",
    zhPinyin: "shÃ­ yÃ¬",
    fr: "milliard"
  },
  {
    vi: "triá»‡u",
    en: "million, millions",
    zh: "ç™¾ä¸‡",
    zhPinyin: "bÇŽi wÃ n",
    fr: "million"
  },
  {
    vi: "láº»",
    en: "zero",
    zh: "é›¶",
    zhPinyin: "lÃ­ng",
    fr: "zÃ©ro / et"
  },
  {
    vi: "má»‘t",
    en: "one, used after twenty",
    zh: "ä¸€",
    zhPinyin: "yÄ«",
    fr: "un (aprÃ¨s vingt)"
  },
  {
    vi: "lÄƒm",
    en: "five, used after ten",
    zh: "äº”",
    zhPinyin: "wÇ”",
    fr: "cinq (aprÃ¨s dix)"
  },
  {
    vi: "nhiá»u",
    en: "many, lots of",
    zh: "å¾ˆå¤š",
    zhPinyin: "hÄ›n duÅ",
    fr: "beaucoup"
  },
  {
    vi: "tÆ°",
    en: "four, private",
    zh: "å›› / ç§äºº",
    zhPinyin: "sÃ¬ / sÄ« rÃ©n",
    fr: "quatre / privÃ©"
  },
  {
    vi: "mÆ°á»i",
    en: "number ten",
    zh: "å",
    zhPinyin: "shÃ­",
    fr: "dix"
  },
  {
    vi: "chÃ­n",
    en: "number nine",
    zh: "ä¹",
    zhPinyin: "jiÇ”",
    fr: "neuf"
  },
  {
    vi: "tÃ¡m",
    en: "number eight",
    zh: "å…«",
    zhPinyin: "bÄ",
    fr: "huit"
  },
  {
    vi: "báº£y",
    en: "number seven",
    zh: "ä¸ƒ",
    zhPinyin: "qÄ«",
    fr: "sept"
  },
  {
    vi: "sÃ¡u",
    en: "number six",
    zh: "å…­",
    zhPinyin: "liÃ¹",
    fr: "six"
  },
  {
    vi: "trÆ°á»Ÿng thÃ nh",
    en: "mature, adult",
    zh: "æˆç†Ÿ",
    zhPinyin: "chÃ©ng shÃº",
    fr: "adulte, mÃ»r"
  },
  {
    vi: "tiá»‡n lá»£i",
    en: "convenient, easy to use",
    zh: "æ–¹ä¾¿",
    zhPinyin: "fÄng biÃ n",
    fr: "pratique"
  },
  {
    vi: "Ã­ch ká»·",
    en: "selfish, self-centered",
    zh: "è‡ªç§",
    zhPinyin: "zÃ¬ sÄ«",
    fr: "Ã©goÃ¯ste"
  },
  {
    vi: "náº·ng",
    en: "heavy, weighty",
    zh: "é‡",
    zhPinyin: "zhÃ²ng",
    fr: "lourd"
  },
  {
    vi: "thÃ¢n thiá»‡n",
    en: "friendly, kind",
    zh: "å‹å¥½",
    zhPinyin: "yÇ’u hÇŽo",
    fr: "amical"
  },
  {
    vi: "lá»‹ch sá»±",
    en: "polite, well-mannered",
    zh: "æœ‰ç¤¼è²Œ",
    zhPinyin: "yÇ’u lÇ mÃ o",
    fr: "poli"
  },
  {
    vi: "tá»‡",
    en: "bad, poor quality",
    zh: "ç³Ÿç³•",
    zhPinyin: "zÄo gÄo",
    fr: "mauvais"
  },
  {
    vi: "truyá»n thá»‘ng",
    en: "traditional, tradition",
    zh: "ä¼ ç»Ÿ",
    zhPinyin: "chuÃ¡n tÇ’ng",
    fr: "traditionnel, tradition"
  },
  {
    vi: "sai",
    en: "wrong, incorrect",
    zh: "é”™è¯¯",
    zhPinyin: "cuÃ² wÃ¹",
    fr: "faux"
  },
  {
    vi: "buá»“n",
    en: "sad, sorry",
    zh: "éš¾è¿‡",
    zhPinyin: "nÃ¡n guÃ²",
    fr: "triste"
  },
  {
    vi: "bÆ°á»›ng bá»‰nh",
    en: "stubborn, not flexible",
    zh: "å›ºæ‰§",
    zhPinyin: "gÃ¹ zhÃ­",
    fr: "tÃªtu"
  },
  {
    vi: "nghiÃªm tÃºc",
    en: "serious, not joking",
    zh: "ä¸¥è‚ƒ",
    zhPinyin: "yÃ¡n sÃ¹",
    fr: "sÃ©rieux"
  }
];

const LANGUAGE_HINTS = {
  vi: "vi-VN",
  en: "en-US",
  zh: "zh-CN",
  fr: "fr-FR"
};

let currentFilter = "all";
let searchTerm = "";
let preferredVoices = {};

function initVoices() {
  if (!("speechSynthesis" in window)) return;
  
  const voices = window.speechSynthesis.getVoices();
  if (!voices.length) return;

  Object.keys(LANGUAGE_HINTS).forEach(lang => {
    const hint = LANGUAGE_HINTS[lang];
    let langGroup = voices.filter(v => v.lang && v.lang.startsWith(hint));
    
    if (lang === "fr") {
      // PRIORITY 1: Female Natural/Neural French voices
      const femaleNaturalFr = langGroup.filter(v => {
        const name = v.name.toLowerCase();
        const isFemale = name.includes("female") || name.includes("f") || 
                        name.includes("woman") || name.includes("denise") ||
                        name.includes("hÃ©lÃ¨ne") || name.includes("zira") ||
                        (v.gender && v.gender.toLowerCase() === "female");
        const isNatural = name.includes("neural") || name.includes("natural") || 
                         name.includes("premium") || name.includes("enhanced");
        return isFemale && isNatural;
      });
      if (femaleNaturalFr.length) {
        preferredVoices[lang] = femaleNaturalFr[0];
        return;
      }
      
      // PRIORITY 2: Any Natural/Neural French voices
      const naturalFr = langGroup.filter(v => {
        const name = v.name.toLowerCase();
        return name.includes("neural") || name.includes("natural") || 
               name.includes("premium") || name.includes("enhanced");
      });
      if (naturalFr.length) {
        const femaleNatural = naturalFr.find(v => {
          const name = v.name.toLowerCase();
          return name.includes("female") || name.includes("f") || 
                 name.includes("woman") || name.includes("denise") ||
                 name.includes("hÃ©lÃ¨ne") ||
                 (v.gender && v.gender.toLowerCase() === "female");
        });
        preferredVoices[lang] = femaleNatural || naturalFr[0];
        return;
      }
      
      // PRIORITY 3: Female French voices
      const femaleFr = langGroup.filter(v => {
        const name = v.name.toLowerCase();
        return name.includes("female") || name.includes("f") || 
               name.includes("woman") || name.includes("denise") ||
               name.includes("hÃ©lÃ¨ne") ||
               (v.gender && v.gender.toLowerCase() === "female");
      });
      if (femaleFr.length) {
        preferredVoices[lang] = femaleFr[0];
        return;
      }
      
      // PRIORITY 4: Google French voices
      const googleFr = langGroup.filter(v => 
        v.name.toLowerCase().includes("google")
      );
      if (googleFr.length) {
        preferredVoices[lang] = googleFr[0];
        return;
      }
      
      // Fallback: any French voice
      if (langGroup.length) {
        preferredVoices[lang] = langGroup[0];
        return;
      }
    }
    
    if (lang === "en") {
      // PRIORITY 1: Female Natural/Neural voices (best quality, natural sound)
      const femaleNaturalEn = langGroup.filter(v => {
        const name = v.name.toLowerCase();
        const isFemale = name.includes("female") || name.includes("f") || 
                        name.includes("woman") || name.includes("zira") ||
                        name.includes("aria") || name.includes("susan") ||
                        name.includes("hazel") || name.includes("linda") ||
                        (v.gender && v.gender.toLowerCase() === "female");
        const isNatural = name.includes("neural") || name.includes("natural") || 
                         name.includes("premium") || name.includes("enhanced") ||
                         name.includes("online") || name.includes("aria");
        return isFemale && isNatural;
      });
      if (femaleNaturalEn.length) {
        preferredVoices[lang] = femaleNaturalEn[0];
        return;
      }
      
      // PRIORITY 2: Any Natural/Neural voices (preferring female)
      const naturalEn = langGroup.filter(v => {
        const name = v.name.toLowerCase();
        return name.includes("neural") || name.includes("natural") || 
               name.includes("premium") || name.includes("enhanced") ||
               name.includes("online") || name.includes("aria");
      });
      if (naturalEn.length) {
        const femaleNatural = naturalEn.find(v => {
          const name = v.name.toLowerCase();
          return name.includes("female") || name.includes("f") || 
                 name.includes("woman") || name.includes("zira") ||
                 name.includes("aria") || name.includes("susan") ||
                 name.includes("hazel") || name.includes("linda") ||
                 (v.gender && v.gender.toLowerCase() === "female");
        });
        preferredVoices[lang] = femaleNatural || naturalEn[0];
        return;
      }
      
      // PRIORITY 3: High-quality female voices
      const qualityFemaleEn = langGroup.filter(v => {
        const name = v.name.toLowerCase();
        return (name.includes("aria") && name.includes("online")) ||
               (name.includes("google") && name.includes("female")) ||
               name.includes("zira") || name.includes("susan") ||
               name.includes("hazel") || name.includes("linda") ||
               (name.includes("female") && (name.includes("us") || name.includes("uk")));
      });
      if (qualityFemaleEn.length) {
        preferredVoices[lang] = qualityFemaleEn[0];
        return;
      }
      
      // PRIORITY 4: Any female English voice
      const femaleEn = langGroup.filter(v => {
        const name = v.name.toLowerCase();
        return name.includes("female") || name.includes("f") || 
               name.includes("woman") ||
               (v.gender && v.gender.toLowerCase() === "female");
      });
      if (femaleEn.length) {
        preferredVoices[lang] = femaleEn[0];
        return;
      }
      
      // PRIORITY 5: Google English voices
      const googleEn = langGroup.filter(v => 
        v.name.toLowerCase().includes("google")
      );
      if (googleEn.length) {
        preferredVoices[lang] = googleEn[0];
        return;
      }
      
      // Fallback: any English voice
      if (langGroup.length) {
        preferredVoices[lang] = langGroup[0];
        return;
      }
    }
    
    // For other languages (Vietnamese, Chinese), prefer female natural voices too
    if (langGroup.length) {
      const femaleNatural = langGroup.find(v => {
        const name = v.name.toLowerCase();
        const isFemale = name.includes("female") || name.includes("f") || 
                        name.includes("woman") ||
                        (v.gender && v.gender.toLowerCase() === "female");
        const isNatural = name.includes("neural") || name.includes("natural") || 
                         name.includes("premium") || name.includes("enhanced");
        return isFemale && isNatural;
      });
      preferredVoices[lang] = femaleNatural || langGroup[0];
    } else {
      preferredVoices[lang] = voices.find(v => v.lang && v.lang.startsWith(lang)) || voices[0];
    }
  });
  
  if (preferredVoices.fr) {
    console.log('Selected French voice:', preferredVoices.fr.name, preferredVoices.fr.lang);
  }
  if (preferredVoices.en) {
    console.log('Selected English voice:', preferredVoices.en.name, preferredVoices.en.lang);
  }
}

if ("speechSynthesis" in window) {
  const loadVoices = () => {
    const voices = window.speechSynthesis.getVoices();
    if (voices.length > 0) {
      initVoices();
    } else {
      setTimeout(loadVoices, 100);
    }
  };
  
  window.speechSynthesis.onvoiceschanged = () => {
    loadVoices();
  };
  loadVoices();
  
  const initializeVoicesOnInteraction = () => {
    const voices = window.speechSynthesis.getVoices();
    if (voices.length > 0) {
      initVoices();
    } else {
      setTimeout(() => {
        const retryVoices = window.speechSynthesis.getVoices();
        if (retryVoices.length > 0) {
          initVoices();
        }
      }, 200);
    }
  };
  
  document.addEventListener('touchstart', initializeVoicesOnInteraction);
  document.addEventListener('click', initializeVoicesOnInteraction);
  document.addEventListener('mousedown', initializeVoicesOnInteraction);
}

function speakWord(text, lang) {
  if (!("speechSynthesis" in window)) {
    console.log('Speech synthesis not available');
    return;
  }
  
  try {
    window.speechSynthesis.cancel();
  } catch (e) {
    console.log('Error canceling speech:', e);
  }
  
  setTimeout(() => {
    const voices = window.speechSynthesis.getVoices();
    
    if (voices.length > 0) {
      if (!preferredVoices[lang] || Object.keys(preferredVoices).length === 0) {
        initVoices();
      }
    }
    
    const freshVoices = window.speechSynthesis.getVoices();
    if (freshVoices.length === 0) {
      console.log('No voices available');
      return;
    }
    
    const utterance = new SpeechSynthesisUtterance(text);
    
    if (lang === "fr") {
      utterance.rate = 0.9;
      utterance.pitch = 1.0;
      utterance.volume = 1.0;
    } else if (lang === "en") {
      utterance.rate = 0.9;
      utterance.pitch = 1.0;
      utterance.volume = 1.0;
    } else {
      utterance.rate = 0.95;
      utterance.pitch = 1.0;
      utterance.volume = 1.0;
    }
    
    utterance.lang = LANGUAGE_HINTS[lang] || lang;
    
    let voice = preferredVoices[lang];
    if (!voice) {
      const hint = LANGUAGE_HINTS[lang];
      const langGroup = freshVoices.filter(v => v.lang && v.lang.startsWith(hint || lang));
      voice = langGroup[0] || freshVoices.find(v => v.lang && v.lang.startsWith(lang)) || freshVoices[0];
    }
    
    if (voice) {
      try {
        utterance.voice = voice;
        utterance.lang = voice.lang || LANGUAGE_HINTS[lang] || lang;
      } catch (e) {
        console.log('Error setting voice:', e);
      }
    }
    
    utterance.onerror = (e) => {
      console.log('Speech error:', e, 'for language:', lang);
    };
    
    try {
      if (window.speechSynthesis.paused) {
        window.speechSynthesis.resume();
      }
      
      window.speechSynthesis.speak(utterance);
    } catch (e) {
      console.log('Error speaking:', e);
      setTimeout(() => {
        try {
          window.speechSynthesis.cancel();
          window.speechSynthesis.speak(utterance);
        } catch (retryError) {
          console.log('Final retry failed:', retryError);
        }
      }, 100);
    }
  }, 50);
}

function matchesFilter(vocab) {
  if (currentFilter === "all") return true;
  
  const searchLower = searchTerm.toLowerCase();
  const matchesSearch = !searchTerm || 
    vocab.fr.toLowerCase().includes(searchLower) ||
    vocab.en.toLowerCase().includes(searchLower) ||
    vocab.vi.toLowerCase().includes(searchLower) ||
    vocab.zh.toLowerCase().includes(searchLower) ||
    (vocab.zhPinyin && vocab.zhPinyin.toLowerCase().includes(searchLower));
  
  if (!matchesSearch) return false;
  
  if (currentFilter === "fr") return true;
  if (currentFilter === "en") return true;
  if (currentFilter === "vi") return true;
  if (currentFilter === "zh") return true;
  
  return true;
}

function renderVocab() {
  const grid = document.getElementById("vocabGrid");
  const noResults = document.getElementById("noResults");
  const filtered = VOCABULARY.filter(matchesFilter);
  
  if (filtered.length === 0) {
    grid.innerHTML = "";
    noResults.style.display = "block";
    return;
  }
  
  noResults.style.display = "none";
  grid.innerHTML = filtered.map(vocab => `
    <div class="vocab-card">
      <div class="vocab-word">${vocab.fr}</div>
      <div class="vocab-translations">
        <div class="translation-row">
          <span class="lang-label">FR:</span>
          <span class="lang-content">${vocab.fr}</span>
          <button class="play-button" onclick="speakWord('${vocab.fr.split(',')[0].trim().split(' / ')[0].trim().replace(/'/g, "\\'")}', 'fr')" title="Listen">â–¶</button>
        </div>
        <div class="translation-row">
          <span class="lang-label">EN:</span>
          <span class="lang-content">${vocab.en}</span>
          <button class="play-button" onclick="speakWord('${vocab.en.split(',')[0].trim().replace(/'/g, "\\'")}', 'en')" title="Listen">â–¶</button>
        </div>
        <div class="translation-row">
          <span class="lang-label">VI:</span>
          <span class="lang-content">${vocab.vi}</span>
          <button class="play-button" onclick="speakWord('${vocab.vi.replace(/'/g, "\\'")}', 'vi')" title="Listen">â–¶</button>
        </div>
        <div class="translation-row">
          <span class="lang-label">ZH:</span>
          <div class="lang-content">
            ${vocab.zh}
            ${vocab.zhPinyin ? `<div class="pinyin">${vocab.zhPinyin}</div>` : ''}
          </div>
          <button class="play-button" onclick="speakWord('${vocab.zh.replace(/'/g, "\\'")}', 'zh')" title="Listen">â–¶</button>
        </div>
      </div>
    </div>
  `).join("");
}

// Language filter buttons
document.querySelectorAll('.controls button[data-lang]').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.controls button[data-lang]').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentFilter = btn.dataset.lang;
    renderVocab();
  });
});

// Search box
document.getElementById('searchBox').addEventListener('input', (e) => {
  searchTerm = e.target.value;
  renderVocab();
});

  // Initial render
  renderVocab();
  
  // Make speakWord globally available
  window.speakWord = speakWord;
</script>
</body>
</html>

